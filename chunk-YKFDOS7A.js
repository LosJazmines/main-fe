import{a as y}from"./chunk-YVLEHWOY.js";import{a as I}from"./chunk-BFSNZW6T.js";import{a as T}from"./chunk-TPLJ4PUN.js";import{a as _}from"./chunk-MNLYAPXW.js";import{l as E}from"./chunk-EWYMWOI3.js";import"./chunk-HE4HGFF6.js";import{b as S,d as C}from"./chunk-LKSAQKNU.js";import"./chunk-2PA5JSTX.js";import{m as k,u as x}from"./chunk-OE5DTYP4.js";import{Ac as b,Ia as m,Ja as u,Kb as v,Mb as p,Wb as s,Xb as n,ac as g,fc as h,hc as l,rb as c,rc as a,sb as o,sc as f,xa as d}from"./chunk-W7KOHNRA.js";function G(r,P){if(r&1){let t=g();s(0,"div",5)(1,"p",6),a(2,"Error:"),n(),s(3,"p"),a(4),n(),s(5,"button",7),h("click",function(){m(t);let i=l();return u(i.retryLogin())}),a(6," Intentar de nuevo "),n()()}if(r&2){let t=l();c(4),f(t.error)}}var O=(()=>{class r{constructor(t,e,i,w,A,j){this.route=t,this.router=e,this.store=i,this.tokenService=w,this.messageService=A,this.authService=j,this.error=null}ngOnInit(){this.route.queryParams.subscribe(t=>{let e=t.error;if(e){this.error=`Error de autenticaci\xF3n: ${e}`,console.error("Google auth error:",e);return}let i=t.token;i?(this.tokenService.setToken(i),this.validateTokenAndLogin(i)):(this.error="No se recibi\xF3 el token de autenticaci\xF3n",this.messageService.showError("Error al iniciar sesi\xF3n con Google. No se recibi\xF3 el token.","top right",5e3,"Aceptar"),setTimeout(()=>{this.router.navigate(["/login"])},3e3))})}retryLogin(){this.router.navigate(["/login"])}validateTokenAndLogin(t){this.authService.validateToken(t).subscribe({next:e=>{console.log("Token validation response:",e),this.store.dispatch(_({currentUser:e})),this.router.navigate(["/"])},error:e=>{console.error("Error validating token:",e),this.error="Error al validar el token. Por favor, intente iniciar sesi\xF3n nuevamente.",this.messageService.showError("Error al validar el token. Por favor, intente iniciar sesi\xF3n nuevamente.","top right",5e3,"Aceptar"),setTimeout(()=>{this.router.navigate(["/login"])},3e3)}})}static{this.\u0275fac=function(e){return new(e||r)(o(S),o(C),o(E),o(I),o(T),o(y))}}static{this.\u0275cmp=d({type:r,selectors:[["app-google-callback"]],standalone:!0,features:[b],decls:7,vars:1,consts:[[1,"flex","items-center","justify-center","min-h-screen","bg-gray-100"],[1,"p-8","bg-white","rounded-lg","shadow-md"],[1,"text-2xl","font-bold","mb-4"],[1,"text-gray-600"],["class","mt-4 p-4 bg-red-100 text-red-700 rounded",4,"ngIf"],[1,"mt-4","p-4","bg-red-100","text-red-700","rounded"],[1,"font-bold"],[1,"mt-2","px-4","py-2","bg-blue-500","text-white","rounded","hover:bg-blue-600",3,"click"]],template:function(e,i){e&1&&(s(0,"div",0)(1,"div",1)(2,"h2",2),a(3,"Procesando inicio de sesi\xF3n con Google..."),n(),s(4,"p",3),a(5,"Por favor, espere un momento mientras completamos su inicio de sesi\xF3n."),n(),v(6,G,7,1,"div",4),n()()),e&2&&(c(6),p("ngIf",i.error))},dependencies:[x,k],encapsulation:2})}}return r})();export{O as default};
