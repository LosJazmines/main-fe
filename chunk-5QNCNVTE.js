import{a as k}from"./chunk-AIDVS6VN.js";import{a as Ze}from"./chunk-IPD6MQPN.js";import{a as Je}from"./chunk-IBMWJLA5.js";import"./chunk-TKMMNMX2.js";import{a as He,b as We}from"./chunk-OFDQY3IQ.js";import{a as Be,b as $e}from"./chunk-XPIKPJFE.js";import{a as V}from"./chunk-TPLJ4PUN.js";import"./chunk-HE4HGFF6.js";import{A as W,B as Me,C as De,D as Ie,F as Ae,G as Ne,I as Te,M as Ve,N as ke,O as J,P as Re,Q as Oe,R as Le,S as Z,T as K,U as ze,V as ae,a as we,b as L,ba as Pe,c as _,d as z,e as P,ea as je,fa as Ge,ga as Xe,h as j,ha as qe,ja as Y,ka as Qe,l as G,la as T,m as X,r as q,s as Ee,t as M,u as Q,w as N,x as H,y as Fe}from"./chunk-GX2JBJOU.js";import{Ha as B,Ma as ye,Na as $,Oa as Ue}from"./chunk-2PA5JSTX.js";import{k as O,l as Ce,m as U,t as xe,u as F}from"./chunk-OE5DTYP4.js";import{Ac as y,Bc as ve,Dc as A,Fc as Se,Ha as ce,Ia as b,Ic as be,Ja as C,Kb as f,Mb as m,Ta as I,Wb as r,Xb as i,Yb as d,a as pe,ac as R,fc as c,hc as v,nc as re,oc as oe,pc as ne,qa as g,rb as s,rc as a,sb as fe,sc as x,tc as E,wc as ge,xa as w,xc as he,yc as _e}from"./chunk-W7KOHNRA.js";var S=function(o){return o.ADMIN="ADMIN",o.USER="USER",o.ENCARGADO="ENCARGADO",o}(S||{}),ee={[S.ADMIN]:"Administrador",[S.USER]:"Usuario",[S.ENCARGADO]:"Encargado"};var se=(o,p)=>({"border-red-500 focus:ring-red-200":o,"border-gray-300 focus:ring-blue-200":p});function tt(o,p){o&1&&(r(0,"p",16),a(1," Ingresa un email v\xE1lido "),i())}function it(o,p){o&1&&(r(0,"p",16),a(1," La contrase\xF1a debe tener al menos 6 caracteres, una may\xFAscula, una min\xFAscula y un n\xFAmero "),i())}function rt(o,p){if(o&1&&(r(0,"div",1)(1,"label",2),a(2," Contrase\xF1a "),i(),d(3,"input",17),f(4,it,2,0,"p",4),i()),o&2){let e,n,t=v();s(3),m("ngClass",A(2,se,((e=t.userForm.get("password"))==null?null:e.invalid)&&((e=t.userForm.get("password"))==null?null:e.touched),!((e=t.userForm.get("password"))!=null&&e.touched))),s(),m("ngIf",((n=t.userForm.get("password"))==null?null:n.invalid)&&((n=t.userForm.get("password"))==null?null:n.touched))}}function ot(o,p){o&1&&(r(0,"p",16),a(1," El nombre de usuario es requerido "),i())}function nt(o,p){o&1&&(r(0,"p",16),a(1," Debes seleccionar al menos un rol "),i())}var Ke=(()=>{class o{constructor(){this.user=null,this.formSubmit=new I,this.formCancel=new I,this.fb=g(q),this.roleOptions=[{id:[S.USER],text:ee[S.USER]},{id:[S.ADMIN],text:ee[S.ADMIN]},{id:[S.ENCARGADO],text:ee[S.ENCARGADO]}],this.userForm=this.fb.group({username:["",_.required],email:["",[_.required,_.email]],password:["",[_.required,_.minLength(6),_.maxLength(50),_.pattern(/(?:(?=.*\d)|(?=.*\W+))(?![.\n])(?=.*[A-Z])(?=.*[a-z]).*$/)]],address:[""],phoneNumber:[""],roles:[[],_.required],isActive:[!0]})}ngOnInit(){this.updateFormValues()}ngOnChanges(e){e.user&&!e.user.firstChange&&this.updateFormValues()}updateFormValues(){if(this.user){console.log("Updating form with user data:",this.user);let e=this.user.roles||[S.USER];console.log("User roles:",e),this.userForm.patchValue({email:this.user.email||"",username:this.user.username||"",address:this.user.address||"",phoneNumber:this.user.phoneNumber||"",roles:e,isActive:this.user.isActive??!0}),console.log("Available role options:",this.roleOptions);let n=this.roleOptions.find(t=>{let l=t.id.sort(),u=e.sort();return console.log("Comparing:",l,"with",u),JSON.stringify(l)===JSON.stringify(u)});if(console.log("Selected role option:",n),n)this.userForm.get("roles")?.setValue(n.id,{emitEvent:!0});else{console.warn("No matching role option found for user roles:",e);let t=this.roleOptions.find(l=>e.some(u=>l.id.includes(u)));t&&this.userForm.get("roles")?.setValue(t.id,{emitEvent:!0})}this.userForm.get("password")?.clearValidators(),this.userForm.get("password")?.updateValueAndValidity()}else this.userForm.get("roles")?.setValue([S.USER],{emitEvent:!0})}onSubmit(){if(this.userForm.valid){let e=pe({},this.userForm.value);this.user&&delete e.password,this.formSubmit.emit(e)}}onCancel(){this.formCancel.emit()}static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275cmp=w({type:o,selectors:[["app-user-form"]],inputs:{user:"user"},outputs:{formSubmit:"formSubmit",formCancel:"formCancel"},standalone:!0,features:[ce,y],decls:34,vars:18,consts:[[1,"space-y-4","p-4",3,"ngSubmit","formGroup"],[1,"relative"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],["formControlName","email","type","email","placeholder","Ingresa el email",1,"p-2","w-full","border","rounded-[4px]","focus:outline-none","focus:ring-2",3,"ngClass"],["class","mt-1 text-sm text-red-500",4,"ngIf"],["class","relative",4,"ngIf"],["formControlName","username","type","text","placeholder","Ingresa el nombre de usuario",1,"p-2","w-full","border","rounded-[4px]","focus:outline-none","focus:ring-2",3,"ngClass"],["formControlName","phoneNumber","type","tel","placeholder","Ingresa el n\xFAmero de tel\xE9fono (opcional)",1,"p-2","w-full","border","border-gray-300","rounded-[4px]","focus:outline-none","focus:ring-2","focus:ring-blue-200"],["formControlName","address","type","text","placeholder","Ingresa la direcci\xF3n (opcional)",1,"p-2","w-full","border","border-gray-300","rounded-[4px]","focus:outline-none","focus:ring-2","focus:ring-blue-200"],[3,"selectionChange","options","placeholder","initialValue"],[1,"flex","items-center","gap-2"],["type","checkbox","formControlName","isActive","id","isActive",1,"w-4","h-4","text-[#3a5a40]","border-gray-300","rounded","focus:ring-[#3a5a40]"],["for","isActive",1,"text-sm","font-medium","text-gray-700"],[1,"flex","justify-end","gap-2","mt-6"],["type","button",1,"px-4","py-2","text-gray-700","bg-gray-100","hover:bg-gray-200","rounded-[4px]","transition-colors",3,"click"],["type","submit",1,"px-4","py-2","text-white","bg-[#3a5a40]","hover:bg-[#3a5a40]/90","rounded-[4px]","transition-colors","disabled:opacity-50","disabled:cursor-not-allowed",3,"disabled"],[1,"mt-1","text-sm","text-red-500"],["formControlName","password","type","password","placeholder","Ingresa la contrase\xF1a",1,"p-2","w-full","border","rounded-[4px]","focus:outline-none","focus:ring-2",3,"ngClass"]],template:function(n,t){if(n&1&&(r(0,"form",0),c("ngSubmit",function(){return t.onSubmit()}),r(1,"div",1)(2,"label",2),a(3," Email "),i(),d(4,"input",3),f(5,tt,2,0,"p",4),i(),f(6,rt,5,5,"div",5),r(7,"div",1)(8,"label",2),a(9," Nombre de usuario "),i(),d(10,"input",6),f(11,ot,2,0,"p",4),i(),r(12,"div",1)(13,"label",2),a(14," Tel\xE9fono "),i(),d(15,"input",7),i(),r(16,"div",1)(17,"label",2),a(18," Direcci\xF3n "),i(),d(19,"input",8),i(),r(20,"div",1)(21,"label",2),a(22," Roles "),i(),r(23,"app-custom-select",9),c("selectionChange",function(u){return t.userForm.patchValue({roles:u.id})}),i(),f(24,nt,2,0,"p",4),i(),r(25,"div",10),d(26,"input",11),r(27,"label",12),a(28," Usuario activo "),i()(),r(29,"div",13)(30,"button",14),c("click",function(){return t.onCancel()}),a(31," Cancelar "),i(),r(32,"button",15),a(33),i()()()),n&2){let l,u,h,D,de,ie;m("formGroup",t.userForm),s(4),m("ngClass",A(12,se,((l=t.userForm.get("email"))==null?null:l.invalid)&&((l=t.userForm.get("email"))==null?null:l.touched),!((l=t.userForm.get("email"))!=null&&l.touched))),s(),m("ngIf",((u=t.userForm.get("email"))==null?null:u.invalid)&&((u=t.userForm.get("email"))==null?null:u.touched)),s(),m("ngIf",!t.user),s(4),m("ngClass",A(15,se,((h=t.userForm.get("username"))==null?null:h.invalid)&&((h=t.userForm.get("username"))==null?null:h.touched),!((h=t.userForm.get("username"))!=null&&h.touched))),s(),m("ngIf",((D=t.userForm.get("username"))==null?null:D.invalid)&&((D=t.userForm.get("username"))==null?null:D.touched)),s(12),m("options",t.roleOptions)("placeholder","Selecciona un rol")("initialValue",(de=t.userForm.get("roles"))==null?null:de.value),s(),m("ngIf",((ie=t.userForm.get("roles"))==null||ie.value==null?null:ie.value.length)===0),s(8),m("disabled",t.userForm.invalid),s(),E(" ",t.user?"Actualizar":"Crear"," Usuario ")}},dependencies:[F,O,U,M,j,L,we,z,P,G,X,N,Ze],styles:["[_nghost-%COMP%]{display:block}"]})}}return o})();function st(o,p){if(o&1&&(r(0,"div",13),a(1),i()),o&2){let e=v();s(),E(" ",e.error," ")}}var te=(()=>{class o{constructor(){this.user=null,this.close=new I,this.userDeleted=new I,this.userUpdated=new I,this.isLoading=!1,this.error=null,this.dialog=g(J),this.usersService=g(k),this.messageService=g(V)}onFormSubmit(e){this.user?.id&&this.usersService.updateUser(this.user.id,e).subscribe({next:n=>{this.messageService.showSuccess("Usuario actualizado correctamente","top center"),this.userUpdated.emit(n),this.close.emit()},error:()=>{this.messageService.showError("Error al actualizar el usuario","top center")}})}onFormCancel(){this.close.emit()}deleteContact(e){e&&confirm("\xBFEst\xE1s seguro de que deseas eliminar este usuario?")&&(this.isLoading=!0,this.error=null,this.usersService.deleteUser(e.id).subscribe({next:()=>{this.messageService.showSuccess("Usuario eliminado correctamente","top center"),this.userDeleted.emit(e.id),this.close.emit()},error:n=>{this.error="Error al eliminar el usuario",this.messageService.showError(this.error,"top center")},complete:()=>{this.isLoading=!1}}))}blockContact(e){e&&(this.isLoading=!0,this.error=null,this.usersService.toggleUserStatus(e.id,!e.isActive).subscribe({next:n=>{this.messageService.showSuccess(`Usuario ${n.isActive?"activado":"bloqueado"} correctamente`,"top center"),this.userUpdated.emit(n)},error:n=>{this.error="Error al cambiar el estado del usuario",this.messageService.showError(this.error,"top center")},complete:()=>{this.isLoading=!1}}))}getFullName(){return this.user?this.user.fullName||this.user.username:""}getInitials(){return this.user?this.user.username.charAt(0).toUpperCase():""}static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275cmp=w({type:o,selectors:[["app-user-detail"]],inputs:{user:"user"},outputs:{close:"close",userDeleted:"userDeleted",userUpdated:"userUpdated"},standalone:!0,features:[y],decls:18,vars:5,consts:[[1,"min-w-[360px]","bg-white","overflow-hidden"],[1,"relative","h-32","bg-[#3a5a40]/20","backdrop-blur-md"],[1,"absolute","top-2","right-2"],["mat-icon-button","","aria-label","menu",1,"!text-white",3,"click"],["name","x"],[1,"p-4"],[1,"flex","items-center","justify-between","mb-6"],[1,"flex","items-center","gap-3"],[1,"w-10","h-10","bg-[#3a5a40]/80","rounded-full","flex","items-center","justify-center","text-white","font-bold"],[1,"text-lg","font-medium","text-gray-900"],[1,"text-sm","text-gray-500"],[3,"formSubmit","formCancel","user"],["class","mt-4 p-2 bg-red-100 text-red-700 rounded text-center",4,"ngIf"],[1,"mt-4","p-2","bg-red-100","text-red-700","rounded","text-center"]],template:function(n,t){n&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"button",3),c("click",function(){return t.close.emit()}),d(4,"lucide-icon",4),i()()(),r(5,"div",5)(6,"div",6)(7,"div",7)(8,"div",8)(9,"span"),a(10),i()(),r(11,"div")(12,"h2",9),a(13),i(),r(14,"p",10),a(15),i()()()(),r(16,"app-user-form",11),c("formSubmit",function(u){return t.onFormSubmit(u)})("formCancel",function(){return t.close.emit()}),i(),f(17,st,2,1,"div",12),i()()),n&2&&(s(10),x(t.getInitials()),s(3),x(t.user==null?null:t.user.username),s(2),x(t.user==null?null:t.user.email),s(),m("user",t.user),s(),m("ngIf",t.error))},dependencies:[F,U,T,$,M,N,Q,Z,Ke]})}}return o})();function dt(o,p){o&1&&(r(0,"mat-error"),a(1,"Email es requerido"),i())}function pt(o,p){o&1&&(r(0,"mat-error"),a(1,"Email inv\xE1lido"),i())}function ct(o,p){o&1&&(r(0,"mat-error"),a(1,"Formato de tel\xE9fono inv\xE1lido"),i())}function ft(o,p){o&1&&(r(0,"mat-error"),a(1,"C\xF3digo postal inv\xE1lido"),i())}function gt(o,p){if(o&1&&(r(0,"span"),a(1),i()),o&2){let e=v();s(),x(e.data.mode==="create"?"Crear":"Guardar")}}function ht(o,p){o&1&&(r(0,"span"),a(1,"Guardando..."),i())}var ue=(()=>{class o{constructor(e){this.data=e,this.isLoading=!1,this.fb=g(q),this.dialogRef=g(Ve),this.usersService=g(k),this.messageService=g(V),this.userForm=this.fb.group({email:["",[_.required,_.email]],firstName:[""],lastName:[""],phone:["",[_.pattern(/^\+?[0-9\s-]{10,}$/)]],address:[""],city:[""],zipCode:["",[_.pattern(/^\d{5}$/)]],role:["USER",_.required],isActive:[!0],avatar:[""],background:[""]}),e.mode==="edit"&&e.user&&this.userForm.patchValue(e.user)}onSubmit(){if(this.userForm.valid){this.isLoading=!0;let e=this.userForm.value;this.data.mode==="create"?this.usersService.createUser(e).subscribe({next:()=>{this.messageService.showSuccess("Usuario creado correctamente","top center"),this.dialogRef.close(!0)},error:()=>{this.messageService.showError("Error al crear el usuario","top center"),this.isLoading=!1}}):this.data.mode==="edit"&&this.data.user?.id&&this.usersService.updateUser(this.data.user.id,e).subscribe({next:()=>{this.messageService.showSuccess("Usuario actualizado correctamente","top center"),this.dialogRef.close(!0)},error:()=>{this.messageService.showError("Error al actualizar el usuario","top center"),this.isLoading=!1}})}}onCancel(){this.dialogRef.close()}static{this.\u0275fac=function(n){return new(n||o)(fe(ke))}}static{this.\u0275cmp=w({type:o,selectors:[["app-user-form-dialog"]],standalone:!0,features:[y],decls:54,vars:9,consts:[["mat-dialog-title",""],[1,"flex","flex-col","gap-4",3,"formGroup"],["appearance","outline"],["matInput","","formControlName","email","type","email"],[4,"ngIf"],["matInput","","formControlName","firstName"],["matInput","","formControlName","lastName"],["matInput","","formControlName","phone","placeholder","+XX XXX XXX XXX"],["matInput","","formControlName","address"],["matInput","","formControlName","city"],["matInput","","formControlName","zipCode","placeholder","XXXXX"],["formControlName","role"],["value","USER"],["value","ENCARGADO"],["value","ADMIN"],["formControlName","isActive"],["align","end"],["mat-button","",3,"click"],["mat-raised-button","","color","primary",3,"click","disabled"]],template:function(n,t){if(n&1&&(r(0,"h2",0),a(1),i(),r(2,"mat-dialog-content")(3,"form",1)(4,"mat-form-field",2)(5,"mat-label"),a(6,"Email"),i(),d(7,"input",3),f(8,dt,2,0,"mat-error",4)(9,pt,2,0,"mat-error",4),i(),r(10,"mat-form-field",2)(11,"mat-label"),a(12,"Nombre"),i(),d(13,"input",5),i(),r(14,"mat-form-field",2)(15,"mat-label"),a(16,"Apellido"),i(),d(17,"input",6),i(),r(18,"mat-form-field",2)(19,"mat-label"),a(20,"Tel\xE9fono"),i(),d(21,"input",7),f(22,ct,2,0,"mat-error",4),i(),r(23,"mat-form-field",2)(24,"mat-label"),a(25,"Direcci\xF3n"),i(),d(26,"input",8),i(),r(27,"mat-form-field",2)(28,"mat-label"),a(29,"Ciudad"),i(),d(30,"input",9),i(),r(31,"mat-form-field",2)(32,"mat-label"),a(33,"C\xF3digo Postal"),i(),d(34,"input",10),f(35,ft,2,0,"mat-error",4),i(),r(36,"mat-form-field",2)(37,"mat-label"),a(38,"Rol"),i(),r(39,"mat-select",11)(40,"mat-option",12),a(41,"Usuario"),i(),r(42,"mat-option",13),a(43,"Encargado"),i(),r(44,"mat-option",14),a(45,"Administrador"),i()()(),r(46,"mat-slide-toggle",15),a(47," Usuario Activo "),i()()(),r(48,"mat-dialog-actions",16)(49,"button",17),c("click",function(){return t.onCancel()}),a(50,"Cancelar"),i(),r(51,"button",18),c("click",function(){return t.onSubmit()}),f(52,gt,2,1,"span",4)(53,ht,2,0,"span",4),i()()),n&2){let l,u,h,D;s(),x(t.data.mode==="create"?"Nuevo Usuario":"Editar Usuario"),s(2),m("formGroup",t.userForm),s(5),m("ngIf",(l=t.userForm.get("email"))==null?null:l.hasError("required")),s(),m("ngIf",(u=t.userForm.get("email"))==null?null:u.hasError("email")),s(13),m("ngIf",(h=t.userForm.get("phone"))==null?null:h.hasError("pattern")),s(13),m("ngIf",(D=t.userForm.get("zipCode"))==null?null:D.hasError("pattern")),s(16),m("disabled",t.userForm.invalid||t.isLoading),s(),m("ngIf",!t.isLoading),s(),m("ngIf",t.isLoading)}},dependencies:[F,U,T,ye,W,H,Fe,Re,Le,Oe,K,B,De,qe,M,j,L,z,P,G,X],styles:["mat-dialog-content[_ngcontent-%COMP%]{min-width:400px}"]})}}return o})();var _t=(o,p)=>({"bg-green-100 text-green-800":o,"bg-red-100 text-red-800":p}),vt=()=>[5,10,25,100];function St(o,p){if(o&1&&(r(0,"mat-option",21),a(1),i()),o&2){let e=p.$implicit;m("value",e),s(),E(" ",e," ")}}function bt(o,p){if(o&1){let e=R();r(0,"div",22),c("click",function(){let t=b(e).$implicit,l=v();return C(l.openDrawer(t))}),r(1,"div",23)(2,"div",24)(3,"div",25)(4,"div",26)(5,"span",27),a(6),Se(7,"slice"),i()(),r(8,"div")(9,"h3",28),a(10),i(),r(11,"p",29),a(12),i()()(),r(13,"span",30),a(14),i()(),r(15,"div",31)(16,"span",32),a(17),i(),r(18,"div",33)(19,"button",34),c("click",function(){let t=b(e).$implicit,l=v();return C(l.openDrawer(t))}),d(20,"lucide-icon",35),i(),r(21,"button",36),c("click",function(t){let l=b(e).$implicit;return v().toggleUserStatus(l),C(t.stopPropagation())}),d(22,"lucide-icon",37),i(),r(23,"button",38),c("click",function(t){let l=b(e).$implicit;return v().removeUser(l),C(t.stopPropagation())}),d(24,"lucide-icon",39),i()()()()()}if(o&2){let e=p.$implicit;s(6),x(be(7,8,e.username,0,1)),s(4),E(" ",e.fullName||e.username," "),s(2),x(e.email),s(),m("ngClass",A(12,_t,e.isActive,!e.isActive)),s(),E(" ",e.isActive?"Activo":"Inactivo"," "),s(3),x(e.roles[0]),s(4),m("color",e.isActive?"warn":"primary"),s(),m("name",e.isActive?"user-x":"user-check")}}function Ct(o,p){if(o&1){let e=R();r(0,"div",40)(1,"mat-paginator",41),c("page",function(t){b(e);let l=v();return C(l.onPageChange(t))}),i()()}if(o&2){let e=v();s(),m("length",e.totalUsers)("pageSize",e.pageSize)("pageSizeOptions",ve(3,vt))}}function xt(o,p){o&1&&(r(0,"div",42),d(1,"mat-spinner",43),i())}function wt(o,p){o&1&&(r(0,"div",44),d(1,"lucide-icon",45),r(2,"p",46),a(3,"No se encontraron usuarios"),i()())}var ki=(()=>{class o{constructor(){this._adminHeaderStore=g(Je),this._usersService=g(k),this._dialog=g(J),this._messageService=g(V),this.adminHeaderStore$=this._adminHeaderStore.getHeaderTitle(),this.allUsers=[],this.users=[],this.filteredUsers=[],this.totalUsers=0,this.currentPage=1,this.pageSize=10,this.loading=!1,this.statuses=["Todos","Activo","Inactivo"],this.selectedStatus="Todos",this.searchQuery="",this.isDrawerOpen=!1,this.selectedUser=null,this.drawerMode="over",this.displayedColumns=["name","email","role","status","actions"],this.isLoading=!1,this.error=null,this.dataSource=new ae([])}ngOnInit(){this._adminHeaderStore.updateHeaderTitle("Users"),this.loadUsers()}loadUsers(){this.isLoading=!0,this.error=null,this._usersService.getUsers(this.currentPage,this.pageSize).subscribe({next:e=>{this.users=e.data,this.totalUsers=e.total,this.filteredUsers=this.users,this.dataSource=new ae(this.filteredUsers),this.paginator&&(this.paginator.length=this.totalUsers,this.paginator.pageSize=this.pageSize,this.paginator.pageIndex=this.currentPage-1),(this.selectedStatus!=="Todos"||this.searchQuery)&&this.applyFilters()},error:e=>{this.error="Error al cargar usuarios",this._messageService.showError(this.error,"top center")},complete:()=>{this.isLoading=!1}})}closeDrawer(){this.isDrawerOpen=!1,this.selectedUser=null}applyFilters(){this.filteredUsers=this.users.filter(e=>{let n=this.selectedStatus==="Todos"||this.selectedStatus==="Activo"&&e.isActive||this.selectedStatus==="Inactivo"&&!e.isActive,t=this.searchQuery===""||e.email.toLowerCase().includes(this.searchQuery.toLowerCase())||e.username.toLowerCase().includes(this.searchQuery.toLowerCase())||(e.fullName?.toLowerCase().includes(this.searchQuery.toLowerCase())??!1);return n&&t})}openDrawer(e){this.selectedUser=e,this.isDrawerOpen=!0}onBackdropClicked(){this.isDrawerOpen=!1}openDialogAddUser(){this._dialog.open(te,{width:"500px",data:{user:null}}).afterClosed().subscribe(n=>{n&&this.loadUsers()})}removeUser(e){confirm("\xBFEst\xE1 seguro de que desea eliminar este usuario?")&&this._usersService.deleteUser(e.id).subscribe({next:()=>{this._messageService.showSuccess("Usuario eliminado correctamente","top center"),this.loadUsers()},error:()=>{this._messageService.showError("Error al eliminar el usuario","top center")}})}handleSearch(e){this.searchQuery=e,this.currentPage=1,this.loadUsers()}toggleUserStatus(e){this._usersService.toggleUserStatus(e.id,!e.isActive).subscribe({next:n=>{this._messageService.showSuccess(`Usuario ${n.isActive?"activado":"bloqueado"} correctamente`,"top center"),this.loadUsers()},error:()=>{this._messageService.showError("Error al cambiar el estado del usuario","top center")}})}ngAfterViewInit(){this.paginator&&this.paginator.page.subscribe(e=>{this.currentPage=e.pageIndex+1,this.pageSize=e.pageSize,this.loadUsers()})}applyFilter(e){let n=e.target.value;this.dataSource.filter=n.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}openCreateDialog(){this._dialog.open(ue,{width:"500px",data:{mode:"create"}}).afterClosed().subscribe(n=>{n&&this.loadUsers()})}openEditDialog(e){this._dialog.open(ue,{width:"500px",data:{mode:"edit",user:e}}).afterClosed().subscribe(t=>{t&&this.loadUsers()})}openDetailDialog(e){this._dialog.open(te,{width:"400px",data:{user:e}}).afterClosed().subscribe(()=>{this.loadUsers()})}onPageChange(e){this.currentPage=e.pageIndex+1,this.pageSize=e.pageSize,this.loadUsers()}static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275cmp=w({type:o,selectors:[["app-users"]],viewQuery:function(n,t){if(n&1&&(re(Y,5),re(Ne,5)),n&2){let l;oe(l=ne())&&(t.paginator=l.first),oe(l=ne())&&(t.sort=l.first)}},standalone:!0,features:[y],decls:26,vars:12,consts:[["drawer",""],[1,"h-full","inset-0","flex","flex-col","min-w-0","overflow-hidden"],[1,"flex-auto","h-full","bg-card","dark:bg-transparent",3,"backdropClick"],[1,"w-full","md:w-160","dark:bg-gray-900",3,"mode","opened","position","disableClose"],[3,"close","user"],[1,"flex","flex-col"],[1,"flex","flex-col","lg:flex-row","justify-between","items-center","mb-4","gap-4","px-4"],[1,"text-3xl","mb-6","text-[#3a5a40]","!font-playfair","text-start","w-full"],[1,"w-full","flex","flex-col","lg:flex-row","items-center","gap-4"],[1,"w-full","lg:w-[400px]",3,"search","inputPlaceholder"],[1,"w-full","lg:w-max","px-4","py-2","bg-[#3a5a40]/80","text-white","rounded-[4px]","shadow","hover:bg-[#3a5a40]/80","focus:outline-none","transition","flex","items-center","gap-2",3,"click"],["name","plus",1,"w-5","h-5"],[1,"px-4","mb-4"],[3,"valueChange","selectionChange","value"],[3,"value",4,"ngFor","ngForOf"],[1,"px-4"],[1,"grid","grid-cols-1","gap-4"],["class","bg-white rounded-lg shadow-sm hover:shadow-md transition-shadow duration-200 cursor-pointer border border-gray-100",3,"click",4,"ngFor","ngForOf"],["class","mt-4",4,"ngIf"],["class","flex justify-center items-center p-4",4,"ngIf"],["class","flex flex-col items-center justify-center p-8 text-gray-500",4,"ngIf"],[3,"value"],[1,"bg-white","rounded-lg","shadow-sm","hover:shadow-md","transition-shadow","duration-200","cursor-pointer","border","border-gray-100",3,"click"],[1,"p-3"],[1,"flex","items-center","justify-between","mb-2"],[1,"flex","items-center","gap-2"],[1,"w-8","h-8","bg-[#3a5a40]/80","rounded-full","flex","items-center","justify-center","text-white","font-bold","hover:bg-opacity-100","transition-all","duration-300"],[1,"text-sm"],[1,"!mb-0","font-medium","text-gray-900","text-sm"],[1,"!mb-0","text-xs","text-gray-500"],[1,"px-1.5","py-0.5","text-xs","rounded-full",3,"ngClass"],[1,"flex","items-center","justify-between","border-t","pt-2"],[1,"text-xs","text-gray-500"],[1,"flex","items-center","gap-1"],["mat-icon-button","",1,"!text-[#3a5a40]/80","hover:bg-[#3a5a40]/10","!w-8","!h-8",3,"click"],["name","eye",1,"w-4","h-4"],["mat-icon-button","",1,"hover:bg-red-100","!w-8","!h-8",3,"click","color"],[1,"w-4","h-4",3,"name"],["mat-icon-button","","color","warn",1,"hover:bg-red-100","!w-8","!h-8",3,"click"],["name","trash-2",1,"w-4","h-4"],[1,"mt-4"],[3,"page","length","pageSize","pageSizeOptions"],[1,"flex","justify-center","items-center","p-4"],["diameter","40"],[1,"flex","flex-col","items-center","justify-center","p-8","text-gray-500"],["name","users",1,"w-12","h-12","mb-4"],[1,"text-lg"]],template:function(n,t){if(n&1){let l=R();r(0,"div",1)(1,"mat-drawer-container",2),c("backdropClick",function(){return b(l),C(t.onBackdropClicked())}),r(2,"mat-drawer",3,0)(4,"app-user-detail",4),c("close",function(){return b(l),C(t.closeDrawer())}),i()(),r(5,"mat-drawer-content",5)(6,"div",6)(7,"h1",7),a(8," Usuarios "),i(),r(9,"div",8)(10,"app-search-moderno-reactive",9),c("search",function(h){return b(l),C(t.handleSearch(h))}),i(),r(11,"button",10),c("click",function(){return b(l),C(t.openDialogAddUser())}),d(12,"lucide-icon",11),a(13," Agregar Usuario "),i()()(),r(14,"div",12)(15,"mat-form-field")(16,"mat-label"),a(17,"Estado"),i(),r(18,"mat-select",13),_e("valueChange",function(h){return b(l),he(t.selectedStatus,h)||(t.selectedStatus=h),C(h)}),c("selectionChange",function(){return b(l),C(t.applyFilters())}),f(19,St,2,2,"mat-option",14),i()()(),r(20,"div",15)(21,"div",16),f(22,bt,25,15,"div",17),i(),f(23,Ct,2,4,"div",18)(24,xt,2,0,"div",19)(25,wt,4,0,"div",20),i()()()()}n&2&&(s(2),m("mode",t.drawerMode)("opened",t.isDrawerOpen)("position","end")("disableClose",!0),s(2),m("user",t.selectedUser),s(6),m("inputPlaceholder","Buscar por email o nombre"),s(8),ge("value",t.selectedStatus),s(),m("ngForOf",t.statuses),s(3),m("ngForOf",t.filteredUsers),s(),m("ngIf",t.totalUsers>t.pageSize),s(),m("ngIf",t.loading),s(),m("ngIf",!t.loading&&t.filteredUsers.length===0))},dependencies:[F,O,Ce,U,xe,T,$,W,H,K,B,Y,Ge,Xe,je,N,Q,M,Ee,We,He,te,Z,Qe,$e,Be,ze,Te,Ie,Me,Ae,Ue,Pe]})}}return o})();export{ki as default};
