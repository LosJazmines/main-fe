import{a as xt}from"./chunk-2ACECEQB.js";import{a as St}from"./chunk-AIDVS6VN.js";import{a as bt}from"./chunk-IRFR7VQN.js";import{a as xe}from"./chunk-IBMWJLA5.js";import"./chunk-TKMMNMX2.js";import{a as gt,b as ht}from"./chunk-6N3XCOH4.js";import{a as be,b as ie}from"./chunk-OFDQY3IQ.js";import{a as _t,b as vt,c as oe}from"./chunk-ML5Y6O2N.js";import"./chunk-Q7WZ5A67.js";import{a as He,b as Qe}from"./chunk-T6SNZ2SU.js";import{a as rt,b as ve}from"./chunk-RAAZGNEA.js";import{a as at,b as st}from"./chunk-XPIKPJFE.js";import{a as ut}from"./chunk-YVLEHWOY.js";import{a as pt}from"./chunk-BFSNZW6T.js";import{a as ft}from"./chunk-IK6GKZLO.js";import{a as te}from"./chunk-TPLJ4PUN.js";import{c as Oe,e as dt,f as mt,g as ct}from"./chunk-MNLYAPXW.js";import{l as ee}from"./chunk-EWYMWOI3.js";import{a as lt}from"./chunk-HE4HGFF6.js";import"./chunk-HYGMGYDW.js";import{B as he,D as _e,E as Je,J as Xe,L as Ze,Y as et,Z as tt,b as ge,c as j,ca as it,d as Q,da as ot,e as Y,h as K,ha as nt,l as J,la as k,m as X,n as Ge,o as Ue,p as We,r as B,s as Z,t as V,u as I,w as O}from"./chunk-GX2JBJOU.js";import{e as Le,f as qe,j as T}from"./chunk-LKSAQKNU.js";import{Ca as Ye,Ma as $,Na as Ke,a as z,d as Re}from"./chunk-2PA5JSTX.js";import{k as W,l as H,m as A,q as fe,u as w}from"./chunk-OE5DTYP4.js";import{Ac as E,Bc as $e,Cc as ue,Dc as G,Eb as C,Fc as N,Gc as we,Hc as U,Ia as x,Ja as S,Kb as b,L as De,Mb as d,N as Pe,Ra as Ne,Rb as D,S as Ae,Sb as Ee,Ta as v,Ub as ae,Vb as se,Wb as i,Xb as n,Yb as m,a as L,ac as F,b as q,da as ze,e as Fe,fc as c,hc as g,k as Me,ka as Be,kc as me,lb as de,pa as Ve,qa as re,rb as r,rc as s,sb as h,sc as M,tc as f,u as Te,uc as ce,vc as pe,wa as je,xa as y,z as Ie}from"./chunk-W7KOHNRA.js";function Pt(a,u){if(a&1&&(i(0,"li",48),m(1,"img",49),i(2,"div")(3,"p",50),s(4),n(),i(5,"p",51),s(6),n()()()),a&2){let e=u.$implicit;r(),me("alt",e.product.name),d("src",e.product.images[0],de),r(3),M(e.product.name),r(2),ce(" ",e.quantity," x $",e.price," ")}}function At(a,u){if(a&1&&(i(0,"div",31)(1,"div",42)(2,"h4",43),s(3,"Productos"),n(),i(4,"ul"),b(5,Pt,7,5,"li",44),n()(),i(6,"div",42)(7,"h4",43),s(8,"Detalle de Pago"),n(),i(9,"div",45)(10,"div",46)(11,"span"),s(12,"Subtotal:"),n(),i(13,"span"),s(14),n()(),i(15,"div",46)(16,"span"),s(17,"Env\xEDo:"),n(),i(18,"span"),s(19),n()(),i(20,"div",46)(21,"span"),s(22,"M\xE9todo de Env\xEDo:"),n(),i(23,"span"),s(24),n()(),i(25,"div",46)(26,"span"),s(27,"M\xE9todo de Pago:"),n(),i(28,"span"),s(29),n()(),i(30,"div",47)(31,"span"),s(32,"Total:"),n(),i(33,"span"),s(34),n()()()()()),a&2){let e=g();r(5),d("ngForOf",e.order.items),r(9),f("$",e.order.subtotal.toFixed(2),""),r(5),M(e.order.costoEnvio==="gratis"?"Gratis":"$"+e.order.costoEnvio),r(5),M(e.order.metodoEnvio||"Est\xE1ndar"),r(5),M(e.order.metododepago||"Web"),r(5),f("$",e.order.total.toFixed(2),"")}}var Ct=(()=>{class a{constructor(){this.process=new v,this.postpone=new v,this.cancel=new v,this.isOpen=!1,this.updateStatus=new v}toggleOpen(){this.isOpen=!this.isOpen}changeStatus(e){this.updateStatus.emit(e)}printReceipt(e){let o=`
      <html>
        <head>
          <style>
            @media print {
              body {
                font-family: 'Courier New', Courier, monospace;
                font-size: 12px;
                text-align: center;
                margin: 0;
                padding: 5px;
                width: 58mm; /* Ajusta seg\xFAn el ancho del rollo */
              }
              .ticket {
                width: 100%;
                max-width: 58mm; /* Ajuste para impresoras t\xE9rmicas */
              }
              .title {
                font-size: 14px;
                font-weight: bold;
              }
              .info {
                font-size: 12px;
                margin: 2px 0;
              }
              .separator {
                border-top: 1px dashed black;
                margin: 5px 0;
              }
            }
          </style>
        </head>
        <body>
          <div class="ticket">
            <div class="title">Pedido #${e.orderNumber}</div>
            <div class="info"><strong>Cliente:</strong> ${e.nombre_customer}</div>
            <div class="info"><strong>Tel\xE9fono:</strong> ${e.telefono||"No especificado"}</div>
            <div class="info"><strong>Direcci\xF3n:</strong> ${e.direccion}</div>
            <div class="info"><strong>Ciudad:</strong> ${e.ciudad}</div>
            <div class="info"><strong>Estado:</strong> ${e.estado}</div>
            <div class="info"><strong>Pa\xEDs:</strong> ${e.pais}</div>
            <div class="info"><strong>Fecha:</strong> ${new Date(e.createdAt).toLocaleString()}</div>
            <div class="separator"></div>
            <div class="items">
              ${e.items.map(l=>`
                <div class="info">
                  <strong>${l.product.name}</strong><br>
                  ${l.quantity} x $${l.price} = $${(l.quantity*l.price).toFixed(2)}
                </div>
              `).join("")}
            </div>
            <div class="separator"></div>
            <div class="info"><strong>Subtotal:</strong> $${e.subtotal.toFixed(2)}</div>
            <div class="info"><strong>Env\xEDo:</strong> ${e.costoEnvio==="gratis"?"Gratis":"$"+e.costoEnvio}</div>
            <div class="info"><strong>Total:</strong> $${e.total.toFixed(2)}</div>
            <div class="separator"></div>
            <div class="info">\xA1Gracias por su compra!</div>
          </div>
        </body>
      </html>
    `,t=window.open("","_blank");t&&(t.document.write(o),t.document.close(),t.print())}static{this.\u0275fac=function(o){return new(o||a)}}static{this.\u0275cmp=y({type:a,selectors:[["app-order-card-row"]],inputs:{order:"order"},outputs:{process:"process",postpone:"postpone",cancel:"cancel",updateStatus:"updateStatus"},standalone:!0,features:[E],decls:92,vars:49,consts:[[1,"bg-white","shadow-lg","rounded-[4px]","overflow-hidden","border","border-gray-200","p-2"],[1,"flex","flex-col","gap-4","md:flex-row","justify-between","items-center","border-b","border-gray-200","p-2"],[1,"w-full","flex","md:items-center","gap-4"],[1,"flex","items-center","justify-center","w-[45px]","h-[45px]","shadow-lg","rounded-full","bg-slate-400/30","p-2"],["name","package",3,"size"],[1,"w-full","flex","items-start","flex-col"],[1,"text-lg","font-bold","text-black","flex","items-center","justify-center","gap-2"],[1,"flex","items-center","justify-center","gap-2"],["name","box",1,"w-4","h-4","text-gray-600"],[1,"text-sm","font-semibold","text-gray-800"],["name","alarm-clock",1,"w-4","h-4","text-gray-600"],[1,"text-sm","text-gray-600"],[1,"mt-2","md:mt-0","w-full","flex","items-end","flex-col","gap-2"],[1,"px-2","py-1","text-sm","font-medium","rounded",3,"ngClass"],["name","AlarmClockCheck",1,"w-4","h-4","text-green-600"],[1,"text-sm","text-green-600"],[1,"mt-2","flex-col","md:flex-row","flex","gap-4"],[1,"flex","flex-1","flex-col","p-4","gap-2","border-b"],[1,"flex","gap-2","items-center"],[1,"text-base","font-bold","text-black"],["name","user",3,"size"],[1,"text-base"],["name","mail",3,"size"],["name","phone",3,"size"],["name","map-pin",3,"size"],[1,"flex","gap-2","items-center","text-green-600"],["name","gift",3,"size"],[1,"text-base","font-bold"],["name","timer",3,"size"],["name","info",3,"size"],[1,""],[1,"mt-4","flex","gap-6"],[1,"w-full","flex","flex-col","md:flex-row","md:justify-end","gap-2","md:space-x-2","mt-4"],[1,"flex","items-center","gap-2","px-4","py-2","bg-green-500","text-white","rounded-[4px]","hover:bg-green-600",3,"click"],["name","truck",3,"size"],[1,"flex","items-center","gap-2","px-4","py-2","bg-blue-500","text-white","rounded-[4px]","hover:bg-blue-600",3,"click"],["name","circle-check",3,"size"],[1,"flex","items-center","gap-2","px-4","py-2","bg-red-500","text-white","rounded-[4px]","hover:bg-red-600",3,"click"],["name","x",3,"size"],[1,"flex","items-center","gap-2","px-4","py-2","bg-gray-500","text-white","rounded-[4px]","hover:bg-gray-600",3,"click"],["name","printer",3,"size"],[3,"size","name"],[1,"flex-1","p-4","bg-white"],[1,"text-sm","font-semibold","mb-2"],["class","flex items-center space-x-3 py-2 border-b last:border-none",4,"ngFor","ngForOf"],[1,"text-sm","text-gray-700","space-y-2"],[1,"flex","justify-between"],[1,"border-t","pt-2","flex","justify-between","font-semibold","text-black"],[1,"flex","items-center","space-x-3","py-2","border-b","last:border-none"],[1,"w-12","h-12","object-cover","rounded-[4px]",3,"src","alt"],[1,"text-sm","font-medium"],[1,"text-sm","text-gray-500"]],template:function(o,t){o&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),m(4,"lucide-icon",4),n(),i(5,"div",5)(6,"h2",6),s(7," Pedido "),i(8,"div",7),m(9,"lucide-icon",8),i(10,"p",9),s(11),n()()(),i(12,"div",7),m(13,"lucide-icon",10),i(14,"p",11),s(15),N(16,"date"),n()()()(),i(17,"div",12)(18,"span",13),N(19,"orderStatus"),s(20),N(21,"orderStatus"),n(),i(22,"div",7),m(23,"lucide-icon",14),i(24,"p",15),s(25),N(26,"date"),n()()()(),i(27,"div",16)(28,"div",17)(29,"div",18)(30,"h3",19),s(31,"Informaci\xF3n del Cliente:"),n()(),i(32,"div",18),m(33,"lucide-icon",20),i(34,"p",21),s(35),n()(),i(36,"div",18),m(37,"lucide-icon",22),i(38,"p",21),s(39),n()(),i(40,"div",18),m(41,"lucide-icon",23),i(42,"p",21),s(43),n()(),i(44,"div",18),m(45,"lucide-icon",24),i(46,"p",21),s(47),n()()(),i(48,"div",17)(49,"div",25),m(50,"lucide-icon",26),i(51,"h3",27),s(52,"Informaci\xF3n del Env\xEDo:"),n()(),i(53,"div",18),m(54,"lucide-icon",20),i(55,"p",21),s(56),n()(),i(57,"div",18),m(58,"lucide-icon",28),i(59,"p",21),s(60),N(61,"date"),n()(),i(62,"div",18),m(63,"lucide-icon",29),i(64,"p",21),s(65),n()(),i(66,"div",18),m(67,"lucide-icon",23),i(68,"p",21),s(69),n()(),i(70,"div",18),m(71,"lucide-icon",24),i(72,"p",21),s(73),n()()()(),i(74,"div",30),b(75,At,35,6,"div",31),i(76,"div",32)(77,"button",33),c("click",function(){return t.changeStatus("shipped")}),m(78,"lucide-icon",34),s(79," Enviar "),n(),i(80,"button",35),c("click",function(){return t.changeStatus("completed")}),m(81,"lucide-icon",36),s(82," Completar "),n(),i(83,"button",37),c("click",function(){return t.changeStatus("cancelled")}),m(84,"lucide-icon",38),s(85," Cancelar "),n(),i(86,"button",39),c("click",function(){return t.printReceipt(t.order)}),m(87,"lucide-icon",40),s(88," Imprimir Ticket "),n(),i(89,"button",35),c("click",function(){return t.toggleOpen()}),m(90,"lucide-icon",41),s(91),n()()()()),o&2&&(r(4),d("size",24),r(7),f(" #",t.order.orderNumber," "),r(4),f(" ",U(16,36,t.order.createdAt,"dd/MM/yyyy hh:mm a")," "),r(3),d("ngClass",we(19,39,t.order.status).colorClass),r(2),f(" ",we(21,41,t.order.status).translatedStatus," "),r(5),f(" ",U(26,43,t.order.updatedAt,"dd/MM/yyyy hh:mm a")," "),r(8),d("size",16),r(2),f(" ",t.order.nombre_customer||"Sin Nombre"," "),r(2),d("size",16),r(2),f(" ",(t.order.customer==null?null:t.order.customer.email)||"Sin Email"," "),r(2),d("size",16),r(2),f(" ",t.order.telefono||"Sin Tel\xE9fono"," "),r(2),d("size",16),r(2),f(" ",(t.order.customer==null?null:t.order.customer.direccion)||"Sin Direcci\xF3n"," "),r(3),d("size",18),r(4),d("size",16),r(2),f(" ",t.order.nombreDestinatario||"Sin nombre Destinatario"," "),r(2),d("size",16),r(2),f(" ",U(61,46,t.order.createdAt,"dd/MM/yyyy hh:mm a")," "),r(3),d("size",16),r(2),f(" ",t.order.comentarios||"Sin Comentarios"," "),r(2),d("size",16),r(2),f(" ",t.order.telefonoMovil||"Sin Tel\xE9fono M\xF3vil"," "),r(2),d("size",16),r(2),pe(" ",t.order.direccion||"Sin Direcci\xF3n"," - ",t.order.ciudad||"Sin ciudad"," - ",t.order.estado||"Sin estado"," - ",t.order.pais||"Sin pa\xEDs"," "),r(2),D(75,t.isOpen?75:-1),r(3),d("size",16),r(3),d("size",16),r(3),d("size",16),r(3),d("size",16),r(3),d("size",16)("name",t.isOpen?"eye-off":"eye"),r(),f(" ",t.isOpen?"Ocultar Detalles":"Ver Detalles"," "))},dependencies:[w,W,H,fe,k,O,I,Qe,He],styles:["h3[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], p[_ngcontent-%COMP%]{margin:0}"]})}}return a})();var zt=a=>({"border-red-500":a}),yt=a=>({"mb-5":a});function Bt(a,u){a&1&&(i(0,"div",22),s(1," El correo es obligatorio y debe ser v\xE1lido. "),n())}function Vt(a,u){a&1&&(i(0,"div",23)(1,"div",24),m(2,"app-loader",25),n()()),a&2&&(r(2),d("size","20px"))}function jt(a,u){a&1&&(i(0,"div",26),s(1," Usuario encontrado y cargado exitosamente. "),n())}function Nt(a,u){a&1&&(i(0,"div",27),s(1," No se encontr\xF3 el usuario. guardar email para continuar. "),n())}var Et=(()=>{class a{constructor(e,o,t){this.fb=e,this.userService=o,this.authService=t,this.stepCompleted=new v,this.stepBack=new v,this.userFound=C(!1),this.loading=!1,this.destroy$=new Me,this.setUserForm()}ngOnInit(){this.setupEmailSearch()}setUserForm(){this.userForm=this.fb.group({email:["",[j.required,j.email]],customerId:["",[j.required]],name:[""],phone:[""]})}setupEmailSearch(){this.userForm.get("email")?.valueChanges.pipe(Ie(e=>e?.trim()),Pe(400),Ae(),ze(this.destroy$)).subscribe(e=>{console.log("email",e),this.userService.getUserByEmail(e).subscribe(o=>{console.log("user",o),this.loading=!1,o?(this.userForm.get("email")?.setValue(o.email),this.userForm.get("customerId")?.setValue(o.id),this.userForm.get("name")?.setValue(o.username),this.userFound.set(!0)):this.userFound.set(!1)})})}searchUserByEmail(){}saveUser(){let e=this.userForm.get("email")?.value;e!==""&&this.authService.registerEmail(e).subscribe(o=>{this.userFound.set(!0),this.userForm.get("customerId")?.setValue(o.id)})}onSubmit(){console.log("Formulario enviado:",this.userForm.value,this.userFound()),this.userForm.valid&&this.userFound()&&this.stepCompleted.emit(this.userForm.value)}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}static{this.\u0275fac=function(o){return new(o||a)(h(B),h(St),h(ut))}}static{this.\u0275cmp=y({type:a,selectors:[["app-order-step1"]],outputs:{stepCompleted:"stepCompleted",stepBack:"stepBack"},standalone:!0,features:[E],decls:30,vars:20,consts:[[1,"max-w-4xl","mx-auto","p-2","bg-white"],[1,"text-2xl","font-semibold","mb-4"],[3,"ngSubmit","formGroup"],[1,"mb-4"],["for","email",1,"block","text-sm","font-medium","text-gray-700"],[1,"flex","items-center","gap-2"],[1,"flex-1"],["id","email","formControlName","email","type","email","placeholder","Ingrese su correo",1,"mt-1","p-2","w-full","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"ngClass"],["class","text-sm text-red-500",4,"ngIf"],[1,"mt-1","flex","justify-center","items-center","min-h-[38px]","min-w-[38px]","border","border-solid","border-black/10","cursor-pointer","bg-white","text-black","rounded","hover:bg-gray-300",3,"click","type","ngClass"],["name","search",3,"size"],[1,"mt-1","flex","justify-center","items-center","min-h-[38px]","min-w-[38px]","border","border-solid","border-black/10","cursor-pointer","bg-black","text-white","rounded","hover:bg-gray-300",3,"click","disabled","type","ngClass"],["name","save",3,"size"],["for","name",1,"block","text-sm","font-medium","text-gray-700"],["id","name","formControlName","name","type","text","placeholder","Ingrese su nombre",1,"mt-1","p-2","w-full","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["for","phone",1,"block","text-sm","font-medium","text-gray-700"],["id","phone","formControlName","phone","type","text","placeholder","Ingrese su tel\xE9fono",1,"mt-1","p-2","w-full","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["class","text-center mt-4",4,"ngIf"],["class","text-green-500 mt-4",4,"ngIf"],["class","text-red-500 mt-4",4,"ngIf"],[1,"flex","justify-end"],["type","submit",1,"bg-blue-500","text-white","px-4","py-2","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500","hover:bg-blue-600",3,"click","disabled"],[1,"text-sm","text-red-500"],[1,"text-center","mt-4"],[1,"w-[142px]","flex","items-center","justify-center"],[3,"size"],[1,"text-green-500","mt-4"],[1,"text-red-500","mt-4"]],template:function(o,t){if(o&1&&(i(0,"div",0)(1,"h2",1),s(2,"Paso 1: Datos del Usuario"),n(),i(3,"form",2),c("ngSubmit",function(){return t.onSubmit()}),i(4,"div",3)(5,"label",4),s(6,"Correo Electr\xF3nico"),n(),i(7,"div",5)(8,"div",6),m(9,"input",7),b(10,Bt,2,0,"div",8),n(),i(11,"div",5)(12,"button",9),c("click",function(){return t.searchUserByEmail()}),m(13,"lucide-icon",10),n(),i(14,"button",11),c("click",function(){return t.saveUser()}),m(15,"lucide-icon",12),n()()()(),i(16,"div",3)(17,"label",13),s(18,"Nombre"),n(),m(19,"input",14),n(),i(20,"div",3)(21,"label",15),s(22,"Tel\xE9fono"),n(),m(23,"input",16),n(),b(24,Vt,3,1,"div",17)(25,jt,2,0,"div",18)(26,Nt,2,0,"div",19),i(27,"div",20)(28,"button",21),c("click",function(){return t.onSubmit()}),s(29," Siguiente "),n()()()()),o&2){let l,p,_,P;r(3),d("formGroup",t.userForm),r(6),d("ngClass",ue(14,zt,((l=t.userForm.get("email"))==null?null:l.invalid)&&((l=t.userForm.get("email"))==null?null:l.touched))),r(),d("ngIf",((p=t.userForm.get("email"))==null?null:p.invalid)&&((p=t.userForm.get("email"))==null?null:p.touched)),r(2),d("type","button")("ngClass",ue(16,yt,((_=t.userForm.get("email"))==null?null:_.invalid)&&((_=t.userForm.get("email"))==null?null:_.touched))),r(),d("size",24),r(),d("disabled",t.userFound())("type","button")("ngClass",ue(18,yt,((P=t.userForm.get("email"))==null?null:P.invalid)&&((P=t.userForm.get("email"))==null?null:P.touched))),r(),d("size",24),r(9),d("ngIf",t.loading),r(),d("ngIf",t.userFound()),r(),d("ngIf",!t.userFound()&&!t.loading),r(2),d("disabled",!t.userFound())}},dependencies:[w,W,A,k,O,I,Z,K,ge,Q,Y,T,V,J,X,he,_e,xt]})}}return a})();var Rt=()=>["/card-order"];function Lt(a,u){if(a&1){let e=F();i(0,"app-product-card-add",17),c("addToCartEvent",function(t){x(e);let l=g(2);return S(l.addToCart(t))})("removeFromCartEvent",function(t){x(e);let l=g(2);return S(l.removeFromCart(t))})("increaseQuantityEvent",function(t){x(e);let l=g(2);return S(l.increaseQuantity(t))})("decreaseQuantityEvent",function(t){x(e);let l=g(2);return S(l.decreaseQuantity(t))}),n()}if(a&2){let e=u.$implicit,o=g(2);d("product",e)("showCartAdd",!0)("quantity",o.quantities[e.id]||0)}}function qt(a,u){if(a&1&&(i(0,"div",9),ae(1,Lt,1,3,"app-product-card-add",null,Ee),n()),a&2){let e=g();r(),se(e.products())}}function Gt(a,u){a&1&&(i(0,"div",18),m(1,"app-card-not-data-source",19),n()),a&2&&(r(),d("textTitle","Tu carrito est\xE1 vac\xEDo.")("textInfo","Eleg\xED el regalo ideal y sorprend\xE9 a alguien hoy.")("isButtonText",!1))}function Ut(a,u){if(a&1){let e=F();i(0,"app-product-card-add",17),c("addToCartEvent",function(t){x(e);let l=g(3);return S(l.addToCart(t))})("removeFromCartEvent",function(t){x(e);let l=g(3);return S(l.removeFromCart(t))})("increaseQuantityEvent",function(t){x(e);let l=g(3);return S(l.increaseQuantity(t))})("decreaseQuantityEvent",function(t){x(e);let l=g(3);return S(l.decreaseQuantity(t))}),n()}if(a&2){let e=u.$implicit,o=g(3);d("product",e)("showCartAdd",!1)("quantity",o.quantities[e.id]||0)}}function Wt(a,u){if(a&1&&ae(0,Ut,1,3,"app-product-card-add",null,Ee),a&2){let e=g(2);se(e.shoppingCart())}}function Ht(a,u){if(a&1&&(i(0,"div",10),b(1,Gt,2,3,"div",18)(2,Wt,2,0),n()),a&2){let e=g();r(),D(1,e.shoppingCart().length===0?1:2)}}function Qt(a,u){if(a&1){let e=F();i(0,"button",20),c("click",function(){x(e);let t=g();return S(t.stepBack.emit())}),s(1," Volver "),n()}}var kt=(()=>{class a{constructor(e,o,t){this._messageService=e,this.store=o,this._productsService=t,this.stepCompleted=new v,this.stepBack=new v,this.shoppingCart=C([]),this.shoppingCartLength=C(null),this.products=C([]),this.showCartItems=C(!1),this.searchTerm="",this.minPrice=0,this.maxPrice=0,this.category="",this.quantities={}}ngOnInit(){this.getShoppingCart(),this.getProducts()}ngOnDestroy(){this._unsuscribeAll&&this._unsuscribeAll.unsubscribe()}getShoppingCart(){this._unsuscribeAll=this.store.select(ve).subscribe(e=>{e&&(this.shoppingCart.set(e),this.shoppingCartLength.set(e.length),this.quantities=e.reduce((o,t)=>(o[t.id]=t.quantity,o),{}))})}toggleView(){this.showCartItems.set(!this.showCartItems())}removeFromCart(e){this.store.dispatch(dt({productId:e}))}increaseQuantity(e){if(!this.shoppingCart().find(t=>t.id===e)){let t=this.products().find(l=>l.id===e);if(t){this.store.dispatch(Oe({products:t}));return}}this.store.dispatch(mt({productId:e}))}decreaseQuantity(e){this.quantities[e]&&this.quantities[e]>0&&this.quantities[e]--,this.quantities[e]===0?this.removeFromCart(e):this.store.dispatch(ct({productId:e}))}addToCart(e){this.store.dispatch(Oe({products:e}))}filterProducts(){let e={searchTerm:this.searchTerm||void 0,minPrice:this.minPrice>0?this.minPrice:void 0,maxPrice:this.maxPrice>0?this.maxPrice:void 0,category:this.category.trim()||void 0};this._productsService.searchProducts(e).subscribe({next:o=>{this.products.set(o)},error:()=>{this.products.set([])}})}handleSearch(e){this.searchTerm=e?e.trim():"",this.searchTerm?this.filterProducts():this.getProducts()}getProducts(){this._productsService.getAllProducts().subscribe({next:e=>{this.products.set(e)},error:()=>{this.products.set([])}})}onSubmit(){this.shoppingCartLength()!==0&&this.stepCompleted.emit(this.shoppingCart())}getTotalPrice(){let e=0;return this.shoppingCart().forEach(o=>{let t=o.price*o.quantity;e+=t}),e}static{this.\u0275fac=function(o){return new(o||a)(h(te),h(ee),h(ft))}}static{this.\u0275cmp=y({type:a,selectors:[["app-order-step2"]],outputs:{stepCompleted:"stepCompleted",stepBack:"stepBack"},standalone:!0,features:[E],decls:24,vars:10,consts:[[1,"min-h-[360px]","w-full","rounded","p-2","overflow-hidden"],[1,"flex","items-center","justify-between"],[1,"flex","items-center","gap-2"],[1,"text-2xl","font-semibold","mb-4"],["labelPosition","before",3,"change"],["mat-icon-button","","routerLinkActive","router-link-active",1,"relative","text-black","custom-badge",3,"routerLink"],[1,"absolute","-top-[-10px]","right-[23px]","transform","translate-x-1/2","-translate-y-1/2","text-black","text-xs","font-semibold","px-2","py-0.5","rounded-full"],["name","shopping-cart",3,"size"],[3,"search","inputPlaceholder"],[1,"w-full","flex","flex-col","gap-1","max-h-[300px]","overflow-y-auto","my-2"],[1,"w-full","flex","flex-col","gap-1","max-h-[300px]","min-h-[300px]","overflow-y-auto","my-2"],[1,"flex","justify-between","items-center","gap-4"],["mat-button","","class","bg-gray-300 px-4 py-2 rounded border border-black/10",3,"click",4,"ngIf"],[1,"flex","justify-end","items-center","gap-4"],[1,"flex","justify-end"],[1,"text-lg","font-bold"],["type","submit",1,"bg-blue-500","text-white","px-4","py-2","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500","hover:bg-blue-600",3,"click"],[3,"addToCartEvent","removeFromCartEvent","increaseQuantityEvent","decreaseQuantityEvent","product","showCartAdd","quantity"],[1,"w-full","h-full"],[1,"",3,"textTitle","textInfo","isButtonText"],["mat-button","",1,"bg-gray-300","px-4","py-2","rounded","border","border-black/10",3,"click"]],template:function(o,t){o&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"h2",3),s(4,"Paso 2: Agregar Productos"),n()(),i(5,"div",2)(6,"p")(7,"mat-slide-toggle",4),c("change",function(){return t.toggleView()}),s(8),n()(),i(9,"button",5)(10,"span",6),s(11),n(),m(12,"lucide-icon",7),n()()(),i(13,"app-search-moderno-reactive",8),c("search",function(p){return t.handleSearch(p)}),n(),b(14,qt,3,0,"div",9)(15,Ht,3,1,"div",10),i(16,"div",11),b(17,Qt,2,0,"button",12),i(18,"div",13)(19,"div",14)(20,"p",15),s(21),n()(),i(22,"button",16),c("click",function(){return t.onSubmit()}),s(23," Siguiente "),n()()()()),o&2&&(r(8),f(" ",t.showCartItems()?"Ver productos":"Ver art\xEDculos agregados"," "),r(),d("routerLink",$e(9,Rt)),r(2),f(" ",t.shoppingCartLength()," "),r(),d("size",24),r(),d("inputPlaceholder","Buscar por Direccion o Nombre del destinatario"),r(),D(14,t.showCartItems()?-1:14),r(),D(15,t.showCartItems()?15:-1),r(2),d("ngIf",!0),r(4),f("Total: $",t.getTotalPrice(),""))},dependencies:[T,Le,qe,k,$,Ke,nt,O,I,w,A,ie,be,gt,ht],styles:["h2[_ngcontent-%COMP%], h3[_ngcontent-%COMP%], p[_ngcontent-%COMP%]{margin:0}"]})}}return a})();function Yt(a,u){if(a&1){let e=F();i(0,"button",29),c("click",function(){x(e);let t=g();return S(t.stepBack.emit())}),s(1," Volver "),n()}}var Ft=(()=>{class a{constructor(e){this.fb=e,this.stepCompleted=new v,this.stepBack=new v,this.center={lat:-37.320437,lng:-59.139153},this.zoom=15,this.destinatarioForm=this.fb.group({nombre:["",j.required],direccion:["",j.required],telefonoMovil:["",[]],pais:[""],estado:[""],ciudad:[""],comentarios:[""],latitud:[""],longitud:[""],metodoEnvio:["DELIVERY"]})}handleAddressChange(e){console.log("handleAddressChange",e);let o=e.geometry.location.lat(),t=e.geometry.location.lng();this.center={lat:o,lng:t},this.destinatarioForm.patchValue({direccion:e.formatted_address,ciudad:this.getAddressComponent(e,"locality")||"",estado:this.getAddressComponent(e,"administrative_area_level_1")||"",pais:this.getAddressComponent(e,"country")||"",latitud:o,longitud:t})}getAddressComponent(e,o){let t=e.address_components.find(l=>l.types.includes(o));return t?t.long_name:""}onAddressInput(){return Fe(this,null,function*(){let e=this.destinatarioForm.get("direccion")?.value;e.length>5&&this.geocodeAddress(e)})}geocodeAddress(e){new google.maps.Geocoder().geocode({address:e},(t,l)=>{if(l==="OK"&&t&&t[0]){let p=t[0].geometry.location.lat(),_=t[0].geometry.location.lng();this.center={lat:p,lng:_},this.destinatarioForm.patchValue({latitud:p,longitud:_}),console.log("Geocoded Address:",this.center)}})}usarMiUbicacion(){navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{let o=e.coords.latitude,t=e.coords.longitude;this.center={lat:o,lng:t},this.obtenerDireccionDesdeCoords(o,t)},e=>{console.error("Error obteniendo la ubicaci\xF3n:",e),alert("No se pudo obtener la ubicaci\xF3n. Aseg\xFArate de permitir el acceso.")}):alert("Tu navegador no soporta geolocalizaci\xF3n.")}obtenerDireccionDesdeCoords(e,o){let t=new google.maps.Geocoder,l={lat:e,lng:o};t.geocode({location:l},(p,_)=>{_==="OK"&&p&&p[0]?(this.destinatarioForm.patchValue({direccion:p[0].formatted_address,latitud:e,longitud:o}),console.log("Direcci\xF3n obtenida:",p[0].formatted_address)):console.error("No se pudo obtener la direcci\xF3n:",_)})}onSubmit(){console.log("Valor del comentario en step3:",this.destinatarioForm.get("comentarios")?.value),console.log("Formulario enviado:",this.destinatarioForm.value),this.destinatarioForm.valid&&(console.log("Formulario enviado:",this.destinatarioForm.value),this.stepCompleted.emit(this.destinatarioForm.value))}static{this.\u0275fac=function(o){return new(o||a)(h(B))}}static{this.\u0275cmp=y({type:a,selectors:[["app-order-step3"]],outputs:{stepCompleted:"stepCompleted",stepBack:"stepBack"},standalone:!0,features:[E],decls:44,vars:6,consts:[[1,"container","mx-auto","max-w-4xl","p-2","bg-white"],[1,"text-2xl","font-semibold","mb-4"],[3,"ngSubmit","formGroup"],[1,"flex","gap-2","items-center"],[1,"mb-4","flex-1"],["for","nombre",1,"block","text-sm","font-medium","text-gray-700"],["id","nombre","formControlName","nombre","type","text","placeholder","Nombre completo",1,"mt-1","p-2","w-full","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["for","telefono",1,"block","text-sm","font-medium","text-gray-700"],["id","telefonoMovil","formControlName","telefonoMovil","type","tel","placeholder","+549 11 12345678",1,"mt-1","p-2","w-full","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],[1,"mb-4"],["for","direccion",1,"block","text-sm","font-medium","text-gray-700"],["id","direccion","formControlName","direccion","type","text","placeholder","Direcci\xF3n","ngx-google-places-autocomplete","",1,"mt-1","p-2","w-full","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"onAddressChange","input"],["matRipple","",1,"mt-1","flex","justify-center","items-center","min-h-[38px]","min-w-[38px]","border","border-solid","border-black/10","cursor-pointer","bg-black","text-white","rounded","hover:bg-gray-300",3,"click"],["name","map-pin-house",3,"size"],[1,"mb-4","w-full"],["for","pais",1,"block","text-sm","font-medium","text-gray-700"],["id","pais","formControlName","pais","type","text","placeholder","Argentina",1,"mt-1","p-2","w-full","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["for","estado",1,"block","text-sm","font-medium","text-gray-700"],["id","estado","formControlName","estado","type","text","placeholder","Buenos Aires",1,"mt-1","p-2","w-full","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["for","ciudad",1,"block","text-sm","font-medium","text-gray-700"],["id","ciudad","formControlName","ciudad","type","text","placeholder","Ciudad",1,"mt-1","p-2","w-full","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],[1,"w-full","h-[120px]","lg:h-auto","rounded","shadow-lg","overflow-hidden","mb-4"],["width","100%","height","120px",3,"center","zoom"],[3,"position"],["for","comentarios",1,"block","text-sm","font-medium","text-gray-700"],["id","comentarios","formControlName","comentarios","placeholder","Por ejemplo 'No funciona bien el timbre'",1,"mt-1","p-2","w-full","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],[1,"flex","justify-between","items-center","gap-4"],["mat-button","","class","bg-gray-300 px-4 py-2 rounded",3,"click",4,"ngIf"],["type","submit",1,"bg-blue-500","text-white","px-4","py-2","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500","hover:bg-blue-600"],["mat-button","",1,"bg-gray-300","px-4","py-2","rounded",3,"click"]],template:function(o,t){o&1&&(i(0,"div",0)(1,"h2",1),s(2,"Paso 3: Datos del Destinatario"),n(),i(3,"form",2),c("ngSubmit",function(){return t.onSubmit()}),i(4,"div",3)(5,"div",4)(6,"label",5),s(7,"Nombre del destinatario"),n(),m(8,"input",6),n(),i(9,"div",4)(10,"label",7),s(11,"Tel\xE9fono 3 destinatario"),n(),m(12,"input",8),n()(),i(13,"div",9)(14,"label",10),s(15,"Direcci\xF3n completa de entrega"),n(),i(16,"div",3)(17,"input",11),c("onAddressChange",function(p){return t.handleAddressChange(p)})("input",function(){return t.onAddressInput()}),n(),i(18,"button",12),c("click",function(){return t.usarMiUbicacion()}),m(19,"lucide-icon",13),n()()(),i(20,"div",3)(21,"div",14)(22,"label",15),s(23,"Pa\xEDs de entrega"),n(),m(24,"input",16),n(),i(25,"div",14)(26,"label",17),s(27,"Estado / Provincia"),n(),m(28,"input",18),n(),i(29,"div",14)(30,"label",19),s(31,"Ciudad / Barrio / Localidad"),n(),m(32,"input",20),n()(),i(33,"div",21)(34,"google-map",22),m(35,"map-marker",23),n()(),i(36,"div",9)(37,"label",24),s(38,"Comentarios / Observaciones sobre el domicilio de entrega"),n(),m(39,"textarea",25),n(),i(40,"div",26),b(41,Yt,2,0,"button",27),i(42,"button",28),s(43," Siguiente "),n()()()()),o&2&&(r(3),d("formGroup",t.destinatarioForm),r(16),d("size",24),r(15),d("center",t.center)("zoom",t.zoom),r(),d("position",t.center),r(6),d("ngIf",!0))},dependencies:[T,k,$,Ye,O,I,w,A,oe,_t,vt,V,K,ge,Q,Y,J,X],styles:["h3[_ngcontent-%COMP%], p[_ngcontent-%COMP%]{margin:0}"]})}}return a})();function Kt(a,u){if(a&1&&(i(0,"option",13),s(1),n()),a&2){let e=u.$implicit;d("value",e.id),r(),f(" ",e.nombre," ")}}function Jt(a,u){a&1&&(i(0,"div",14),s(1," La forma de pago es obligatoria. "),n())}function Xt(a,u){if(a&1){let e=F();i(0,"button",15),c("click",function(){x(e);let t=g();return S(t.stepBack.emit())}),s(1," Volver "),n()}}var Mt=(()=>{class a{constructor(e){this.fb=e,this.stepCompleted=new v,this.stepBack=new v,this.formasDePago=[{id:"efectivo",nombre:"Efectivo"},{id:"transferencia",nombre:"Transferencia"},{id:"web",nombre:"Web"}],this.formaPagoForm=this.fb.group({formaDePago:["",j.required]})}onSubmit(){if(this.formaPagoForm.valid){let e=this.formaPagoForm.get("formaDePago")?.value;console.log("Forma de Pago seleccionada:",e),this.stepCompleted.emit(e)}else console.log("Por favor, seleccione una forma de pago.")}static{this.\u0275fac=function(o){return new(o||a)(h(B))}}static{this.\u0275cmp=y({type:a,selectors:[["app-order-step4"]],outputs:{stepCompleted:"stepCompleted",stepBack:"stepBack"},standalone:!0,features:[E],decls:17,vars:4,consts:[[1,"container","mx-auto","max-w-4xl","p-2","bg-white"],[1,"text-2xl","font-semibold","mb-4"],[3,"ngSubmit","formGroup"],[1,"flex","gap-2","items-center"],[1,"mb-4","flex-1"],["for","formaDePago",1,"block","text-sm","font-medium","text-gray-700"],["id","formaDePago","formControlName","formaDePago",1,"mt-1","p-2","w-full","border","border-gray-300","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500"],["value","","disabled","","selected",""],[3,"value",4,"ngFor","ngForOf"],["class","text-sm text-red-500",4,"ngIf"],[1,"flex","justify-between","items-center","gap-4"],["mat-button","","class","bg-gray-300 px-4 py-2 rounded",3,"click",4,"ngIf"],["type","submit",1,"bg-blue-500","text-white","px-4","py-2","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500","hover:bg-blue-600"],[3,"value"],[1,"text-sm","text-red-500"],["mat-button","",1,"bg-gray-300","px-4","py-2","rounded",3,"click"]],template:function(o,t){if(o&1&&(i(0,"div",0)(1,"h2",1),s(2,"Seleccione la Forma de Pago"),n(),i(3,"form",2),c("ngSubmit",function(){return t.onSubmit()}),i(4,"div",3)(5,"div",4)(6,"label",5),s(7,"Forma de Pago"),n(),i(8,"select",6)(9,"option",7),s(10,"Seleccione una opci\xF3n"),n(),b(11,Kt,2,2,"option",8),n(),b(12,Jt,2,0,"div",9),n()(),i(13,"div",10),b(14,Xt,2,0,"button",11),i(15,"button",12),s(16," Siguiente "),n()()()()),o&2){let l;r(3),d("formGroup",t.formaPagoForm),r(8),d("ngForOf",t.formasDePago),r(),d("ngIf",((l=t.formaPagoForm.get("formaDePago"))==null?null:l.invalid)&&((l=t.formaPagoForm.get("formaDePago"))==null?null:l.touched)),r(2),d("ngIf",!0)}},dependencies:[T,k,$,O,w,H,A,oe,V,K,Ue,We,Ge,Q,Y,J,X]})}}return a})();function Zt(a,u){if(a&1&&(i(0,"li",23),m(1,"img",24),i(2,"div")(3,"p",25),s(4),n(),i(5,"p",26),s(6),n()()()),a&2){let e=u.$implicit;r(),me("alt",e==null?null:e.name),d("src",e==null?null:e.images[0],de),r(3),M(e==null?null:e.name),r(2),ce(" ",e==null?null:e.quantity," x $",e==null?null:e.price," ")}}function ei(a,u){if(a&1){let e=F();i(0,"button",27),c("click",function(){x(e);let t=g();return S(t.stepBack.emit())}),s(1," Volver "),n()}}var Tt=(()=>{class a{constructor(e){this.store=e,this.stepCompleted=new v,this.stepBack=new v,this.order=Ne(),this.edit=new v,this.confirm=new v,this.shoppingCart=C([])}ngOnInit(){this.getShoppingCart()}ngOnDestroy(){this._unsuscribeAll&&this._unsuscribeAll.unsubscribe()}getShoppingCart(){this._unsuscribeAll=this.store.select(ve).subscribe(e=>{e&&this.shoppingCart.set(e)})}onEdit(){this.edit.emit()}onSubmit(){this.confirm.emit("confirm")}static{this.\u0275fac=function(o){return new(o||a)(h(ee))}}static{this.\u0275cmp=y({type:a,selectors:[["app-order-step5"]],inputs:{order:[je.SignalBased,"order"],userData:"userData",productData:"productData",shippingData:"shippingData",paymentData:"paymentData"},outputs:{stepCompleted:"stepCompleted",stepBack:"stepBack",edit:"edit",confirm:"confirm"},standalone:!0,features:[E],decls:65,vars:29,consts:[[1,"container","mx-auto","max-w-4xl","p-2","bg-white"],[1,"text-2xl","font-bold","mb-2"],[1,"flex","gap-4"],[1,"flex","flex-1","flex-col","p-2","border-b"],[1,"flex","gap-2","items-center"],[1,"text-base","font-bold","text-blue-600"],["name","user",3,"size"],[1,"text-base"],["name","mail",3,"size"],["name","phone",3,"size"],["name","map-pin",3,"size"],[1,"flex","gap-2","items-center","text-green-600"],["name","gift",3,"size"],[1,"text-base","font-bold"],["name","timer",3,"size"],["name","info",3,"size"],[1,"section"],[1,"flex-1","p-4","bg-white"],[1,"text-sm","font-semibold","mb-2"],["class","flex items-center space-x-3 py-2 border-b last:border-none",4,"ngFor","ngForOf"],[1,"flex","justify-between","items-center","gap-4"],["mat-button","","class","bg-gray-300 px-4 py-2 rounded",3,"click",4,"ngIf"],["type","submit",1,"bg-blue-500","text-white","px-4","py-2","rounded-md","focus:outline-none","focus:ring-2","focus:ring-blue-500","hover:bg-blue-600",3,"click"],[1,"flex","items-center","space-x-3","py-2","border-b","last:border-none"],[1,"w-12","h-12","object-cover","rounded-md",3,"src","alt"],[1,"text-sm","font-medium"],[1,"text-sm","text-gray-500"],["mat-button","",1,"bg-gray-300","px-4","py-2","rounded",3,"click"]],template:function(o,t){if(o&1&&(i(0,"div",0)(1,"h2",1),s(2,"Revisar y Confirmar"),n(),i(3,"div",2)(4,"div",3)(5,"div",4)(6,"h3",5),s(7," Informaci\xF3n del Cliente: "),n()(),i(8,"div",4),m(9,"lucide-icon",6),i(10,"p",7),s(11),n()(),i(12,"div",4),m(13,"lucide-icon",8),i(14,"p",7),s(15),n()(),i(16,"div",4),m(17,"lucide-icon",9),i(18,"p",7),s(19),n()(),i(20,"div",4),m(21,"lucide-icon",10),i(22,"p",7),s(23),n()()(),i(24,"div",3)(25,"div",11),m(26,"lucide-icon",12),i(27,"h3",13),s(28,"Informaci\xF3n del Env\xEDo:"),n()(),i(29,"div",4),m(30,"lucide-icon",6),i(31,"p",7),s(32),n()(),i(33,"div",4),m(34,"lucide-icon",14),i(35,"p",7),s(36),N(37,"date"),n()(),i(38,"div",4),m(39,"lucide-icon",15),i(40,"p",7),s(41),n()(),i(42,"div",4),m(43,"lucide-icon",8),i(44,"p",7),s(45),n()(),i(46,"div",4),m(47,"lucide-icon",9),i(48,"p",7),s(49),n()(),i(50,"div",4),m(51,"lucide-icon",10),i(52,"p",7),s(53),n()()()(),i(54,"div",16)(55,"div",17)(56,"h4",18),s(57,"Productos"),n(),i(58,"ul"),b(59,Zt,7,5,"li",19),n()()(),m(60,"div",16),i(61,"div",20),b(62,ei,2,0,"button",21),i(63,"button",22),c("click",function(){return t.onSubmit()}),s(64," Confirmar Pedido "),n()()()),o&2){let l,p,_;r(9),d("size",16),r(2),f(" ",t.order().nombre_customer?t.order().nombre_customer:"Sin Nombre"," "),r(2),d("size",16),r(2),f(" ",(l=t.order())!=null&&l.customer_email?t.order().customer_email:"Sin Email"," "),r(2),d("size",16),r(2),f(" ",t.order().telefono?t.order().telefono:"Sin Telefono"," "),r(2),d("size",16),r(2),f(" ",(p=t.order())!=null&&p.customer_direccion?t.order().customer_direccion:"Sin Direccion"," "),r(3),d("size",18),r(4),d("size",16),r(2),f(" ",t.order().nombreDestinatario?t.order().nombreDestinatario:"Sin nombre Destinatario"," "),r(2),d("size",16),r(2),f(" ",(_=U(37,26,t.order().createdAt,"dd/MM/yyyy hh:mm a"))!==null&&_!==void 0?_:"Sin Fecha"," "),r(3),d("size",16),r(2),f(" ",t.order().comentarios?t.order().comentarios:"Sin Comentarios"," "),r(2),d("size",16),r(2),f(" ",t.order().email?t.order().email:"Sin Email"," "),r(2),d("size",16),r(2),f(" ",t.order().telefonoMovil?t.order().telefonoMovil:"Sin Telefono"," "),r(2),d("size",16),r(2),pe(" ",t.order().direccion?t.order().direccion:"Sin Direccion"," - ",t.order().ciudad?t.order().ciudad:"Sin ciudad"," - ",t.order().estado?t.order().estado:"Sin estado"," - ",t.order().pais?t.order().pais:"Sin pais"," "),r(6),d("ngForOf",t.shoppingCart()),r(3),d("ngIf",!0)}},dependencies:[T,k,$,O,I,w,H,A,fe,oe,V],styles:["h3[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], p[_ngcontent-%COMP%]{margin:0}"]})}}return a})();var Ce=(()=>{class a{constructor(e){this._http=e,this.urlOrders=`${lt.api}/orders`}getAllOrders(){let e=new z({"Content-Type":"application/json"});return this._http.get(`${this.urlOrders}`,{headers:e})}getOrderById(e){let o=new z({"Content-Type":"application/json"});return this._http.get(`${this.urlOrders}/${e}`,{headers:o})}createOrder(e){let o=new z({"Content-Type":"application/json"});return this._http.post(`${this.urlOrders}`,e,{headers:o}).pipe(De(t=>{console.error("Error creating order:",t);let l="Error al crear la orden";return t.error&&t.error.message&&(l=t.error.message),Te(()=>new Error(l))}))}updateOrder(e,o){let t=new z({"Content-Type":"application/json"});return this._http.put(`${this.urlOrders}/${e}`,o,{headers:t})}deleteOrder(e){let o=new z({"Content-Type":"application/json"});return this._http.delete(`${this.urlOrders}/${e}`,{headers:o})}updateOrderStatus(e,o){let t=new z({"Content-Type":"application/json"});return this._http.patch(`${this.urlOrders}/${e}/status`,{status:o},{headers:t})}searchOrders(e={}){let o=new z({"Content-Type":"application/json"});return this._http.post(`${this.urlOrders}/search`,e,{headers:o})}getOrdersByStatus(e){let o=new z({"Content-Type":"application/json"});return this._http.get(`${this.urlOrders}/status/${e}`,{headers:o})}getOrderCounts(){let e=new z({"Content-Type":"application/json"});return this._http.get(`${this.urlOrders}/counts`,{headers:e})}static{this.\u0275fac=function(o){return new(o||a)(Ve(Re))}}static{this.\u0275prov=Be({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})();var Dt=(()=>{class a{goToStep(e){this.currentStep=e,console.log({currentStep:this.currentStep})}constructor(e,o,t,l){this.fb=e,this.orderService=o,this.dialogRef=t,this._messageService=l,this._adminHeaderStore=re(xe),this.adminHeaderStore$=this._adminHeaderStore.getHeaderTitle(),this.currentStep=0,this.orderData=C({customerId:null,nombre_customer:"",items:[],total:0,status:"pending",nombreDestinatario:"",direccion:"",ciudad:"",estado:"",pais:"",telefono:"",telefonoMovil:"",comentarios:"",latitud:null,longitud:null,costoEnvio:"",metodoEnvio:"",metododepago:""}),this.isLoading=C(!1)}ngOnInit(){this._adminHeaderStore.updateHeaderTitle("Pedidos - Agregar Pedido")}onStep1Completed(e){this.orderData.update(o=>q(L({},o),{customerId:e.customerId,nombre_customer:e.name,telefono:e.phone})),console.log({orderData:this.orderData()}),this.goToStep(1)}onStep2Completed(e){console.log("productsData:",e),this.orderData.update(o=>q(L({},o),{items:e.map(t=>({productId:t.id,quantity:t.quantity,price:t.price}))})),console.log({orderData2:this.orderData()}),this.goToStep(2)}onStep3Completed(e){console.log("Comentario recibido en step3:",e.comentarios),console.log({destinatarioData:e}),this.orderData.update(o=>q(L({},o),{nombreDestinatario:e.nombre,direccion:e.direccion,ciudad:e.ciudad,estado:e.estado,pais:e.pais,telefonoMovil:e.telefonoMovil,comentarios:e.comentarios,latitud:e.latitud,longitud:e.longitud,metodoEnvio:e.metodoEnvio||"DELIVERY",costoEnvio:"gratis"})),console.log("Comentario guardado en orderData:",this.orderData().comentarios),console.log({orderData3:this.orderData()}),this.goToStep(3)}onStep4Completed(e){console.log("paymentData:",e),this.orderData.update(o=>q(L({},o),{metododepago:e})),console.log({orderData4:this.orderData()}),this.goToStep(4)}onStep5Completed(e){this.orderData.update(o=>q(L({},o),{total:e.total})),this.confirmOrder()}confirmOrder(){this.isLoading.set(!0);let e={customerId:this.orderData().customerId,nombre_customer:this.orderData().nombre_customer,items:this.orderData().items,total:this.orderData().total,status:this.orderData().status,nombreDestinatario:this.orderData().nombreDestinatario,direccion:this.orderData().direccion,ciudad:this.orderData().ciudad,estado:this.orderData().estado,pais:this.orderData().pais,telefono:this.orderData().telefono,telefonoMovil:this.orderData().telefonoMovil,comentarios:this.orderData().comentarios||null,latitud:this.orderData().latitud,longitud:this.orderData().longitud,costoEnvio:this.orderData().costoEnvio,metodoEnvio:this.orderData().metodoEnvio,metododepago:this.orderData().metododepago};console.log("Comentario en el body de la orden:",e.comentarios),console.log("Orden finalizada:",e),this.orderService.createOrder(e).subscribe({next:o=>{console.log("Respuesta de la creaci\xF3n de la orden:",o),this._messageService.showInfo("Orden creada exitosamente","bottom right",5e3),this.dialogRef.close({success:!0}),this.isLoading.set(!1)},error:o=>{console.error("Error al crear la orden:",o);let t=o.message||"Error al crear la orden";this._messageService.showError(t,"bottom right",5e3),this.isLoading.set(!1)}})}closeModal(){this.dialogRef.close({success:!0})}goBack(){this.currentStep>0&&this.currentStep--}static{this.\u0275fac=function(o){return new(o||a)(h(B),h(Ce),h(Xe),h(te))}}static{this.\u0275cmp=y({type:a,selectors:[["app-add-order"]],standalone:!0,features:[E],decls:15,vars:2,consts:[[1,"max-w-3xl","mx-auto","p-2","bg-white","shadow-lg","rounded-lg"],[1,"pt-2"],[1,"text-2xl","font-bold","mb-4","text-center"],["labelPosition","bottom",1,"h-full",3,"selectedIndex"],[1,"flex","flex-col","justify-between"],[3,"stepCompleted"],[3,"stepBack","stepCompleted"],[3,"stepBack","confirm","order"]],template:function(o,t){o&1&&(i(0,"div",0)(1,"div",1)(2,"h1",2),s(3,"Crear Orden"),n()(),i(4,"mat-horizontal-stepper",3)(5,"mat-step",4)(6,"app-order-step1",5),c("stepCompleted",function(p){return t.onStep1Completed(p)}),n()(),i(7,"mat-step")(8,"app-order-step2",6),c("stepBack",function(){return t.goBack()})("stepCompleted",function(p){return t.onStep2Completed(p)}),n()(),i(9,"mat-step")(10,"app-order-step3",6),c("stepBack",function(){return t.goBack()})("stepCompleted",function(p){return t.onStep3Completed(p)}),n()(),i(11,"mat-step")(12,"app-order-step4",6),c("stepBack",function(){return t.goBack()})("stepCompleted",function(p){return t.onStep4Completed(p)}),n()(),i(13,"mat-step")(14,"app-order-step5",7),c("stepBack",function(){return t.goBack()})("confirm",function(p){return t.onStep5Completed(p)}),n()()()()),o&2&&(r(4),d("selectedIndex",t.currentStep),r(10),d("order",t.orderData()))},dependencies:[w,k,it,ot,O,Z,T,V,he,_e,Et,kt,Ft,Mt,Tt,ie],styles:[".mat-horizontal-content-container{padding:0!important}  .mat-horizontal-stepper-header-container{display:none!important}"]})}}return a})();var ii=(a,u)=>u.id,ye=(a,u)=>({"!bg-[#3a5a40]/65 !text-white  shadow":a,"border border-gray-200 shadow-md":u}),oi=(a,u)=>({"!bg-[#3a5a40]/65 !text-white shadow":a,"border border-gray-200 shadow-md":u});function ni(a,u){a&1&&(i(0,"div",7),m(1,"mat-spinner",10),n())}function ri(a,u){if(a&1){let e=F();i(0,"div",8)(1,"p",11),s(2),n(),i(3,"button",12),c("click",function(){x(e);let t=g();return S(t.loadInitialOrders())}),s(4," Reintentar "),n()()}if(a&2){let e=g();r(2),M(e.errorMessage())}}function ai(a,u){a&1&&(i(0,"div",28)(1,"p",29),s(2,"No hay \xF3rdenes disponibles"),n()())}function si(a,u){if(a&1){let e=F();i(0,"app-order-card-row",30),c("updateStatus",function(t){let l=x(e).$implicit,p=g(3);return S(p.updateOrder(l.id,t))}),n()}if(a&2){let e=u.$implicit;d("order",e)}}function li(a,u){if(a&1&&ae(0,si,1,1,"app-order-card-row",null,ii),a&2){let e=g(2);se(e.orders())}}function di(a,u){if(a&1){let e=F();i(0,"div",9)(1,"div",13)(2,"div",14),m(3,"span",15),i(4,"span",16),s(5),n()(),i(6,"div",17)(7,"span"),s(8),n()()(),i(9,"div",18)(10,"div",9)(11,"mat-button-toggle-group",19),c("change",function(t){x(e);let l=g();return S(l.onFilterChange(t.value))}),i(12,"mat-button-toggle",20)(13,"mat-icon",21),s(14,"schedule"),n(),i(15,"span",22),s(16,"Pendiente"),n(),i(17,"span"),s(18),n()(),i(19,"mat-button-toggle",23)(20,"mat-icon",21),s(21,"local_shipping"),n(),i(22,"span",22),s(23,"Enviado"),n(),i(24,"span"),s(25),n()(),i(26,"mat-button-toggle",24)(27,"mat-icon",21),s(28,"check_box"),n(),i(29,"span",22),s(30,"Completado"),n(),i(31,"span"),s(32),n()(),i(33,"mat-button-toggle",25)(34,"mat-icon",21),s(35,"highlight_off"),n(),i(36,"span",22),s(37,"Cancelado"),n(),i(38,"span"),s(39),n()(),i(40,"mat-button-toggle",26)(41,"span",22),s(42,"Todos"),n(),i(43,"span"),s(44),n()()(),i(45,"div",27),b(46,ai,3,0,"div",28)(47,li,2,0),n()()()()}if(a&2){let e=g();r(3),d("ngClass",e.isWebSocketConnected?"bg-green-500":"bg-red-500"),r(),d("ngClass",e.isWebSocketConnected?"text-green-600":"text-red-600"),r(),f(" ",e.isWebSocketConnected?"Conectado en tiempo real":"Desconectado - Reconectando..."," "),r(3),f("",e.orders().length," Items disponibles"),r(3),d("value",e.selectedFilter),r(),d("ngClass",G(16,ye,e.selectedFilter==="pendiente",e.selectedFilter!=="pendiente")),r(6),M(e.pendingCount),r(),d("ngClass",G(19,ye,e.selectedFilter==="enviado",e.selectedFilter!=="enviado")),r(6),M(e.sentCount),r(),d("ngClass",G(22,oi,e.selectedFilter==="completado",e.selectedFilter!=="completado")),r(6),M(e.completedCount),r(),d("ngClass",G(25,ye,e.selectedFilter==="cancelado",e.selectedFilter!=="cancelado")),r(6),M(e.canceledCount),r(),d("ngClass",G(28,ye,e.selectedFilter==="todos",e.selectedFilter!=="todos")),r(4),M(e.allOrders().length),r(2),D(46,e.orders().length===0?46:47)}}var Sn=(()=>{class a{constructor(e,o,t,l,p,_){this._fb=e,this._dialog=o,this._ordersService=t,this.store=l,this._tokenService=p,this._messageService=_,this._adminHeaderStore=re(xe),this._webSocketService=re(bt),this.adminHeaderStore$=this._adminHeaderStore.getHeaderTitle(),this.orders=C([]),this.allOrders=C([]),this.isLoading=C(!1),this.hasError=C(!1),this.errorMessage=C(""),this.pendingCount=0,this.sentCount=0,this.completedCount=0,this.canceledCount=0,this.selectedFilter="pendiente",this.searchTerm="",this.selectedDate=null,this.isWebSocketConnected=!1,this.subscriptions=[],this.statusMap={pendiente:"pending",enviado:"shipped",completado:"completed",cancelado:"cancelled",todos:"all"}}ngOnInit(){this._adminHeaderStore.updateHeaderTitle("Pedidos"),this.loadInitialOrders(),this.checkAuthAndInitSocket()}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}checkAuthAndInitSocket(){this.store.select(rt).subscribe(e=>{console.log("Current user state:",e);let o=this._tokenService.getToken();console.log("Token from service:",o?"Present":"Not present"),e&&o?(console.log("User is authenticated, initializing WebSocket"),this.setupWebSocketConnection()):(console.log("User not authenticated or token missing"),e||console.log("No user in store"),o||console.log("No token available"))})}setupWebSocketConnection(){let e=this._tokenService.getToken();if(!e){console.error("No token available for WebSocket connection");return}console.log("Connecting WebSocket with token"),this._webSocketService.connect(e);let o=this._webSocketService.getConnectionStatus().subscribe(t=>{console.log("WebSocket connection status:",t),this.isWebSocketConnected=t,t?(this.setupWebSocketListeners(),this.hasError.set(!1),this.errorMessage.set(""),this._messageService.showSuccess("Conexi\xF3n WebSocket establecida","top right",3e3)):this._messageService.showError("Conexi\xF3n WebSocket perdida","top right",3e3)});this.subscriptions.push(o)}setupWebSocketListeners(){console.log("Setting up WebSocket listeners");let e=this._webSocketService.getNewOrders().subscribe(l=>{if(console.log("New order received:",l),l){let p=this.allOrders();this.allOrders.set([l,...p]),this.calculateCounts(this.allOrders()),this.loadOrders(),this._messageService.showSuccess(`Nueva orden #${l.orderNumber} recibida`,"top right",5e3)}}),o=this._webSocketService.getOrderUpdates().subscribe(l=>{if(console.log("Order update received:",l),l){let _=this.allOrders().map(P=>P.id===l.id?l:P);this.allOrders.set(_),this.calculateCounts(_),this.loadOrders()}}),t=this._webSocketService.getOrderStatusChanges().subscribe(l=>{if(console.log("Order status change received:",l),l){let _=this.allOrders().map(P=>P.id===l.id?l:P);this.allOrders.set(_),this.calculateCounts(_),this.loadOrders()}});this.subscriptions.push(e,o,t)}loadInitialOrders(){this.isLoading()||(this.isLoading.set(!0),this.hasError.set(!1),this.errorMessage.set(""),this._ordersService.getAllOrders().subscribe({next:e=>{this.allOrders.set(e),this.calculateCounts(e),this.loadOrders(),this.isLoading.set(!1)},error:e=>{console.error("Error fetching all orders:",e),this.isLoading.set(!1),this.hasError.set(!0),this.errorMessage.set("Error al cargar las \xF3rdenes")}}))}loadOrders(){if(this.selectedFilter==="todos")this.orders.set(this.allOrders());else{let e=this.statusMap[this.selectedFilter],o=this.allOrders().filter(t=>t.status===e);this.orders.set(o)}}calculateCounts(e){this.pendingCount=e.filter(o=>o.status==="pending").length,this.sentCount=e.filter(o=>o.status==="shipped").length,this.completedCount=e.filter(o=>o.status==="completed").length,this.canceledCount=e.filter(o=>o.status==="cancelled").length}onFilterChange(e){this.selectedFilter=e,this.loadOrders()}handleSearch(e){this.searchTerm=e.trim();let o={};if(this.searchTerm&&(o.searchTerm=this.searchTerm),this.selectedDate&&(o.creationDate=this.formatDate(this.selectedDate)),!o.searchTerm&&!o.creationDate){this.loadOrders();return}this._ordersService.searchOrders(o).subscribe({next:t=>{this.orders.set(t),this.calculateCounts(t)},error:t=>{console.error("Error al buscar \xF3rdenes:",t)}})}formatDate(e){let o=e.getFullYear(),t=(e.getMonth()+1).toString().padStart(2,"0"),l=e.getDate().toString().padStart(2,"0");return`${o}-${t}-${l}`}updateOrder(e,o){this._messageService.closeSnackBar();let t=this.statusMap[o]||o;this._ordersService.updateOrderStatus(e,t).subscribe({next:l=>{this._messageService.showInfo(`Pedido actualizado a "${o}"`,"top right",5e3)},error:l=>{console.error("Error actualizando el pedido:",l),this._messageService.showInfo("Error al actualizar el pedido","top right",5e3,"success")}})}openDialogAddOrder(){this._dialog.open(Dt,{data:{name:"hola",animal:"hola"}}).closed.subscribe(o=>{o?.success,this._adminHeaderStore.updateHeaderTitle("Pedidos")})}onDateChange(e){this.selectedDate=e.value,this.handleSearch(this.searchTerm)}clearDateFilter(){this.selectedDate=null,document.querySelector("input[matInput]").value="",this.handleSearch(this.searchTerm)}togglePanel(e){e.expanded?e.close():e.open()}accionEliminar(e){console.log("Eliminar pedido",e)}accionAprobar(e){console.log("Aprobar pedido",e)}static{this.\u0275fac=function(o){return new(o||a)(h(B),h(Ze),h(Ce),h(ee),h(pt),h(te))}}static{this.\u0275cmp=y({type:a,selectors:[["app-ordes"]],standalone:!0,features:[E],decls:12,vars:4,consts:[[1,"min-h-full"],[1,"flex","flex-col","lg:flex-row","justify-between","items-center","mb-4","gap-4"],[1,"text-3xl","mb-6","text-[#3a5a40]","!font-playfair","text-start","w-full"],[1,"w-full","flex","flex-col","lg:flex-row","items-center","gap-4"],[1,"w-full","lg:w-[400px]",3,"search","inputPlaceholder"],[1,"w-full","lg:w-max","px-4","py-2","bg-[#3a5a40]/80","text-white","rounded-[4px]","shadow","hover:bg-[#3a5a40]/80","focus:outline-none","transition","flex","items-center","gap-2",3,"click"],["name","plus",1,"w-5","h-5"],[1,"flex","justify-center","items-center","h-64"],[1,"flex","flex-col","items-center","justify-center","h-64","text-center"],[1,"w-full"],["diameter","48"],[1,"text-lg","text-gray-700","mb-4"],[1,"px-4","py-2","bg-[#3a5a40]/80","text-white","rounded-[4px]","shadow","hover:bg-[#3a5a40]","focus:outline-none","transition",3,"click"],[1,"flex","justify-end","items-center","mb-5"],[1,"flex","items-center","gap-2","mr-4"],[1,"w-2","h-2","rounded-full","animate-pulse",3,"ngClass"],[1,"text-sm",3,"ngClass"],[1,"text-sm","font-medium"],[1,"flex","flex-col","gap-4"],["appearance","legacy",1,"w-full","pb-2","md:pb-0","flex","md:flex-wrap","md:!flex-row","!flex-col","gap-2","!shadow-none","bg-transparent",3,"change","value"],["value","pendiente",1,"flex","items-center","justify-between","gap-2","rounded-[4px]","transition-colors","duration-200",3,"ngClass"],[1,"text-base"],[1,"px-2"],["value","enviado",1,"flex","items-center","gap-2","transition-colors","rounded-[4px]","duration-200",3,"ngClass"],["value","completado",1,"flex","items-center","gap-2","transition-colors","rounded-[4px]","duration-200",3,"ngClass"],["value","cancelado",1,"flex","items-center","gap-2","transition-colors","rounded-[4px]","duration-200",3,"ngClass"],["value","todos",1,"flex","items-center","gap-2","transition-colors","rounded-[4px]","duration-200",3,"ngClass"],[1,"flex","flex-col","gap-4","my-4"],[1,"flex","flex-col","items-center","justify-center","h-32","text-center"],[1,"text-lg","text-gray-600"],[3,"updateStatus","order"]],template:function(o,t){o&1&&(i(0,"div",0)(1,"div",1)(2,"h1",2),s(3," Ordenes "),n(),i(4,"div",3)(5,"app-search-moderno-reactive",4),c("search",function(p){return t.handleSearch(p)}),n(),i(6,"button",5),c("click",function(){return t.openDialogAddOrder()}),m(7,"lucide-icon",6),s(8," Crear Orden "),n()()(),b(9,ni,2,0,"div",7)(10,ri,5,1,"div",8)(11,di,48,31,"div",9),n()),o&2&&(r(5),d("inputPlaceholder","Buscar por Direccion o Nombre del destinatario"),r(4),D(9,t.isLoading()?9:-1),r(),D(10,t.hasError()?10:-1),r(),D(11,!t.isLoading()&&!t.hasError()?11:-1))},dependencies:[w,W,k,Je,et,tt,O,I,Ct,Z,ie,be,st,at],styles:["h1[_ngcontent-%COMP%]{margin:0}[_nghost-%COMP%]     .mat-button-toggle .mat-pseudo-checkbox{display:none!important}"]})}}return a})();export{Sn as default};
