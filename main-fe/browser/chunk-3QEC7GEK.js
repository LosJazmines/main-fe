import{a as l}from"./chunk-TPLJ4PUN.js";import{a as m}from"./chunk-HE4HGFF6.js";import{d as h}from"./chunk-2PA5JSTX.js";import{w as i}from"./chunk-OE5DTYP4.js";import{L as n,Ya as p,ka as d,pa as a,t as s,z as c}from"./chunk-W7KOHNRA.js";var k=(()=>{class o{constructor(t,e,r){this.http=t,this.messageService=e,this.platformId=r,this.apiUrl=m.api,this.accounts=[],i(this.platformId)&&this.loadAccounts()}loadAccounts(){if(i(this.platformId)){let t=localStorage.getItem("mercadoPagoAccounts");t&&(this.accounts=JSON.parse(t))}}saveAccounts(){i(this.platformId)&&localStorage.setItem("mercadoPagoAccounts",JSON.stringify(this.accounts))}getAccounts(){return this.http.get(`${this.apiUrl}/mercado-pago/accounts`)}addAccount(t){return this.validateCredentials(t).pipe(c(e=>{if(!e)throw new Error("Invalid MercadoPago credentials");return t.id||(t.id=this.accounts.length>0?Math.max(...this.accounts.map(r=>r.id))+1:1),this.accounts.push(t),this.saveAccounts(),this.messageService.showInfo("Cuenta de MercadoPago agregada correctamente","top center"),t}),n(e=>{throw this.messageService.showError("Error al agregar cuenta de MercadoPago: "+e.message,"top center"),e}))}updateAccount(t){return this.validateCredentials(t).pipe(c(e=>{if(!e)throw new Error("Invalid MercadoPago credentials");let r=this.accounts.findIndex(u=>u.id===t.id);if(r===-1)throw new Error("Account not found");return this.accounts[r]=t,this.saveAccounts(),this.messageService.showInfo("Cuenta de MercadoPago actualizada correctamente","top center"),t}),n(e=>{throw this.messageService.showError("Error al actualizar cuenta de MercadoPago: "+e.message,"top center"),e}))}deleteAccount(t){return this.http.delete(`${this.apiUrl}/mercado-pago/accounts/${t}`)}validateCredentials(t){return s(!!t.accessToken&&!!t.publicKey)}createPaymentPreference(t){return s({id:"mock-preference-id",init_point:"https://www.mercadopago.com.ar/checkout/v1/redirect?pref_id=mock-preference-id",sandbox_init_point:"https://sandbox.mercadopago.com.ar/checkout/v1/redirect?pref_id=mock-preference-id"})}getMercadoPagoClientId(){return this.http.get(`${this.apiUrl}/mercado-pago/client-id`)}getPaymentSettings(){return this.http.get(`${this.apiUrl}/mercado-pago/settings`)}setActivePayment(t){return this.http.post(`${this.apiUrl}/mercado-pago/settings/active/${t}`,{})}processOAuthCode(t,e){return this.http.post(`${this.apiUrl}/mercado-pago/oauth/callback`,{code:t,state:e})}static{this.\u0275fac=function(e){return new(e||o)(a(h),a(l),a(p))}}static{this.\u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{k as a};
