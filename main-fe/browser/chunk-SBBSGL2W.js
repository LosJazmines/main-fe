import{a as W}from"./chunk-PIMXYEGF.js";import{c as J}from"./chunk-RAAZGNEA.js";import{a as K,b as Q}from"./chunk-XPIKPJFE.js";import{l as U}from"./chunk-EWYMWOI3.js";import"./chunk-HE4HGFF6.js";import{ia as q,la as G,u as H,w as P}from"./chunk-GX2JBJOU.js";import{d as F}from"./chunk-LKSAQKNU.js";import{Ma as R,Na as O,Pa as V}from"./chunk-2PA5JSTX.js";import{l as N,m as z,q as L,u as D}from"./chunk-OE5DTYP4.js";import{Ac as A,Fc as $,H as w,Hc as B,Ia as _,Ja as b,Kb as f,Mb as c,Ob as y,P as C,T as E,Wb as n,Xb as s,Yb as h,ac as M,da as l,fc as v,hc as u,k as I,ka as T,l as g,rb as a,rc as o,sb as p,sc as S,tc as j,xa as k}from"./chunk-W7KOHNRA.js";var X=(()=>{class t{constructor(){this.headerTitle=new g(""),this.headerTitle$=this.headerTitle.asObservable()}updateHeaderTitle(e){this.headerTitle.next(e)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=T({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();function ee(t,d){t&1&&(n(0,"div",9),h(1,"mat-spinner",10),s())}function te(t,d){t&1&&(n(0,"span",26),o(1," Nuevo "),s())}function ie(t,d){if(t&1){let e=M();n(0,"button",27),v("click",function(){_(e);let r=u().$implicit,m=u(2);return b(m.markAsRead(r.id))}),o(1," Marcar como le\xEDdo "),s()}}function re(t,d){if(t&1){let e=M();n(0,"div",14)(1,"div",15)(2,"div")(3,"h3",16),o(4),f(5,te,2,0,"span",17),s(),n(6,"p",18),o(7),s()(),n(8,"div",19)(9,"span",20),o(10),$(11,"date"),s(),n(12,"button",21),v("click",function(){let r=_(e).$implicit,m=u(2);return b(m.deleteMessage(r.id))}),h(13,"lucide-icon",22),s()()(),n(14,"p",23),o(15),s(),n(16,"div",24),f(17,ie,2,0,"button",25),s()()}if(t&2){let e=d.$implicit;y("border-green-500",!e.read)("border-gray-200",e.read)("transform",!e.read)("hover:scale-[1",!e.read),a(4),j(" ",e.name," "),a(),c("ngIf",!e.read),a(2),S(e.email),a(3),j(" ",B(11,15,e.createdAt,"dd/MM/yyyy HH:mm")," "),a(2),c("matTooltip","Eliminar mensaje"),a(3),S(e.message),a(2),c("ngIf",!e.read)}}function se(t,d){t&1&&(n(0,"div",28),o(1," No hay mensajes nuevos "),s())}function ne(t,d){if(t&1&&(n(0,"div",11),f(1,re,18,18,"div",12)(2,se,2,0,"div",13),s()),t&2){let e=u();a(),c("ngForOf",e.messages),a(),c("ngIf",!e.isLoading&&e.messages.length===0)}}var je=(()=>{class t{constructor(e,i,r,m,x){this.contactService=e,this.adminHeaderStore=i,this.snackBar=r,this.router=m,this.store=x,this.messages=[],this.isLoading=!0,this.destroy$=new I,this.refreshInterval=5*60*1e3,this.refreshing$=new g(!1)}ngOnInit(){this.checkAdminAndInitialize()}ngOnDestroy(){this.intervalSubscription&&this.intervalSubscription.unsubscribe(),this.destroy$.next(),this.destroy$.complete()}checkAdminAndInitialize(){this.store.select(J).pipe(C(1),l(this.destroy$)).subscribe(e=>{e&&(this.adminHeaderStore.updateHeaderTitle("Mensajes"),this.loadMessages(),this.setupAutoRefresh())})}setupAutoRefresh(){this.intervalSubscription=w(this.refreshInterval).pipe(l(this.destroy$)).subscribe(()=>{this.refreshing$.value||this.refreshMessages()})}showNotification(e){this.snackBar.open(e,"Cerrar",{duration:5e3,horizontalPosition:"end",verticalPosition:"top"})}loadMessages(e=!1){e||(this.isLoading=!0),this.contactService.getMessages().pipe(l(this.destroy$),E(()=>{this.isLoading=!1,this.refreshing$.next(!1)})).subscribe({next:i=>{this.messages=i.sort((r,m)=>{let x=r.createdAt?new Date(r.createdAt).getTime():0;return(m.createdAt?new Date(m.createdAt).getTime():0)-x}),e&&this.showNotification("Mensajes actualizados")},error:i=>{console.error("Error al cargar mensajes:",i),this.showNotification("Error al cargar los mensajes")}})}markAsRead(e){this.contactService.markAsRead(e).pipe(l(this.destroy$)).subscribe({next:()=>{let i=this.messages.find(r=>r.id===e);i&&(i.read=!0)},error:i=>{console.error("Error al marcar mensaje como le\xEDdo:",i),this.showNotification("Error al marcar el mensaje como le\xEDdo")}})}deleteMessage(e){confirm("\xBFEst\xE1s seguro de que deseas eliminar este mensaje?")&&this.contactService.deleteMessage(e).pipe(l(this.destroy$)).subscribe({next:()=>{this.messages=this.messages.filter(i=>i.id!==e),this.showNotification("Mensaje eliminado correctamente")},error:i=>{console.error("Error al eliminar mensaje:",i),this.showNotification("Error al eliminar el mensaje")}})}refreshMessages(){this.refreshing$.next(!0),this.loadMessages(!0)}manualRefresh(){this.refreshing$.value||this.refreshMessages()}static{this.\u0275fac=function(i){return new(i||t)(p(W),p(X),p(V),p(F),p(U))}}static{this.\u0275cmp=k({type:t,selectors:[["app-messages"]],standalone:!0,features:[A],decls:12,vars:6,consts:[[1,"p-6"],[1,"mb-6"],[1,"flex","justify-between","items-center"],[1,"text-2xl","font-bold","mb-2"],[1,"text-gray-600"],["mat-icon-button","",1,"text-gray-600","hover:text-gray-800",3,"click","disabled","matTooltip"],["name","refresh-cw","size","20"],["class","flex justify-center items-center py-8",4,"ngIf"],["class","grid gap-4",4,"ngIf"],[1,"flex","justify-center","items-center","py-8"],["diameter","40"],[1,"grid","gap-4"],["class","bg-white p-4 rounded-lg shadow-sm border transition-all duration-200",3,"border-green-500","border-gray-200","transform","hover:scale-[1",4,"ngFor","ngForOf"],["class","text-center py-8 text-gray-500",4,"ngIf"],[1,"bg-white","p-4","rounded-lg","shadow-sm","border","transition-all","duration-200"],[1,"flex","justify-between","items-start","mb-3"],[1,"font-medium","flex","items-center","gap-2"],["class","inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800",4,"ngIf"],[1,"text-sm","text-gray-600"],[1,"flex","items-center","gap-2"],[1,"text-sm","text-gray-500"],["mat-icon-button","",1,"text-red-500","hover:text-red-700",3,"click","matTooltip"],["name","trash-2","size","18"],[1,"text-gray-700","mb-3","whitespace-pre-line"],[1,"flex","justify-end"],["mat-button","","color","primary","class","text-sm",3,"click",4,"ngIf"],[1,"inline-flex","items-center","px-2","py-0.5","rounded","text-xs","font-medium","bg-green-100","text-green-800"],["mat-button","","color","primary",1,"text-sm",3,"click"],[1,"text-center","py-8","text-gray-500"]],template:function(i,r){i&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h2",3),o(5,"Mensajes de Contacto"),s(),n(6,"p",4),o(7,"Gestiona los mensajes recibidos desde el formulario de contacto"),s()(),n(8,"button",5),v("click",function(){return r.manualRefresh()}),h(9,"lucide-icon",6),s()()(),f(10,ee,2,0,"div",7)(11,ne,3,2,"div",8),s()),i&2&&(a(8),c("disabled",r.refreshing$.value)("matTooltip","Actualizar mensajes"),a(),y("animate-spin",r.refreshing$.value),a(),c("ngIf",r.isLoading),a(),c("ngIf",!r.isLoading))},dependencies:[D,N,z,L,G,R,O,q,P,H,Q,K],encapsulation:2})}}return t})();export{je as default};
