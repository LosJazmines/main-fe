import './polyfills.server.mjs';
import{a as L,b as R}from"./chunk-INSH7UNI.mjs";import"./chunk-FPYPD3IL.mjs";import{a as N}from"./chunk-5BCCDAZN.mjs";import"./chunk-XJRGDZK3.mjs";import{a as I}from"./chunk-WOH52GB3.mjs";import"./chunk-TO7CX6ZC.mjs";import{b as V}from"./chunk-L7WINZ3Z.mjs";import"./chunk-VBUU5UXX.mjs";import"./chunk-BEDMNTGR.mjs";import{a as B}from"./chunk-L3H3J3KU.mjs";import"./chunk-G45C3EYB.mjs";import"./chunk-UYWXFIFU.mjs";import{c as v,e as j,f as k,g as D}from"./chunk-LJV6WDRE.mjs";import{l as q}from"./chunk-TTTSTSGJ.mjs";import"./chunk-Y7SIVDIG.mjs";import"./chunk-MVTQIEKU.mjs";import{ia as M,la as Q}from"./chunk-5ITMT7SL.mjs";import"./chunk-3M2R4VPM.mjs";import{e as F,k as A}from"./chunk-D4P4B6JA.mjs";import"./chunk-5TOM3SNX.mjs";import{w as O}from"./chunk-DR63K3YT.mjs";import{Bb as l,Da as c,Ea as p,Hb as h,Jb as g,Oa as _,Ob as C,Pb as w,Rb as E,Sb as b,Tb as o,Ub as a,Vb as T,Zb as S,cc as x,ec as d,ob as s,oc as f,pb as m,sa as y,xc as P}from"./chunk-XTO3CEGG.mjs";import"./chunk-VVCT4QZE.mjs";function $(r,u){r&1&&(o(0,"div",4)(1,"h2",9),f(2,"Productos"),a()())}function z(r,u){if(r&1){let t=S();o(0,"app-product-card-add",10),x("addToCartEvent",function(e){c(t);let n=d();return p(n.addToCart(e))})("removeFromCartEvent",function(e){c(t);let n=d();return p(n.removeFromCart(e))})("increaseQuantityEvent",function(e){c(t);let n=d();return p(n.increaseQuantity(e))})("decreaseQuantityEvent",function(e){c(t);let n=d();return p(n.decreaseQuantity(e))}),a()}if(r&2){let t=u.$implicit,i=d();g("product",t)("showCartAdd",!1)("quantity",i.quantities[t.id]||0)}}function G(r,u){r&1&&(o(0,"div",6),T(1,"app-card-not-data-source",11),a()),r&2&&(s(),g("textTitle","Tu carrito est\xE1 vac\xEDo.")("textInfo","Eleg\xED el regalo ideal y sorprend\xE9 a alguien hoy."))}function H(r,u){r&1&&(o(0,"div",7)(1,"div",12)(2,"h3",13),f(3,"Envio"),a()(),o(4,"div",14)(5,"div",15)(6,"p",16),f(7,"-"),a()()()())}var pt=(()=>{class r{constructor(t,i,e,n){this._messageService=t,this.store=i,this._router=e,this._productsService=n,this.stepCompleted=new _,this.stepBack=new _,this.shoppingCart=l([]),this.shoppingCartLength=l(null),this.products=l([]),this.showCartItems=l(!1),this.searchTerm="",this.minPrice=0,this.maxPrice=0,this.category="",this.quantities={}}ngOnInit(){this.getShoppingCart()}ngOnDestroy(){this._unsuscribeAll&&this._unsuscribeAll.unsubscribe()}getShoppingCart(){this._unsuscribeAll=this.store.select(V).subscribe(t=>{t&&(this.shoppingCart.set(t),this.shoppingCartLength.set(t.length),this.quantities=t.reduce((i,e)=>(i[e.id]=e.quantity,i),{}))})}procesarCompra(){this._router.navigate(["/card-order-map"])}toggleView(){this.showCartItems.set(!this.showCartItems())}removeFromCart(t){this.store.dispatch(j({productId:t}))}increaseQuantity(t){if(!this.shoppingCart().find(e=>e.id===t)){let e=this.products().find(n=>n.id===t);if(e){this.store.dispatch(v({products:e}));return}}this.store.dispatch(k({productId:t}))}decreaseQuantity(t){this.quantities[t]&&this.quantities[t]>0&&this.quantities[t]--,this.quantities[t]===0?this.removeFromCart(t):this.store.dispatch(D({productId:t}))}addToCart(t){this.store.dispatch(v({products:t}))}filterProducts(){let t={searchTerm:this.searchTerm||void 0,minPrice:this.minPrice>0?this.minPrice:void 0,maxPrice:this.maxPrice>0?this.maxPrice:void 0,category:this.category.trim()||void 0};this._productsService.searchProducts(t).subscribe({next:i=>{this.products.set(i)},error:()=>{this.products.set([])}})}onSubmit(){this.shoppingCartLength()!==0&&this.stepCompleted.emit(this.shoppingCart())}getTotalPrice(){let t=0;return this.shoppingCart().forEach(i=>{let e=i.price*i.quantity;t+=e}),t}static{this.\u0275fac=function(i){return new(i||r)(m(B),m(q),m(F),m(I))}}static{this.\u0275cmp=y({type:r,selectors:[["app-card-order"]],outputs:{stepCompleted:"stepCompleted",stepBack:"stepBack"},standalone:!0,features:[P],decls:11,vars:3,consts:[[1,"max-w-[1200px]","mx-auto","py-4","min-h-[calc(100vh-325px)]","lg:min-h-[calc(100vh-305px)]"],[1,"custom-height","flex"],[1,"w-full","h-full","flex-1","flex","flex-col","lg:flex-row","justify-center","items-start","gap-4","px-4"],[1,"lg:min-h-[360px]","w-full","lg:w-[300px]","flex-1","rounded","overflow-hidden"],[1,"border-b","border-black/10","px-4","pt-4","bg-white","rounded-t"],[1,"flex","flex-col","gap-1"],[1,"w-full","h-full"],[1,"flex","items-center","justify-around","bg-white","p-4","border-t","border-black/10","rounded-b","shadow-lg","overflow-hidden"],[1,"w-full","lg:w-auto",3,"continuarCompra"],[1,"text-2xl","font-bold","text-gray-800"],[3,"addToCartEvent","removeFromCartEvent","increaseQuantityEvent","decreaseQuantityEvent","product","showCartAdd","quantity"],[1,"",3,"textTitle","textInfo"],[1,"flex-1","flex","items-center","gap-4","py-4"],[1,"text-lg","font-bold","text-gray-700","mb-2"],[1,"flex","items-start","gap-4","py-4"],[1,"w-[40px]","h-[30px]","flex","items-center","justify-center"],[1,"p-0","text-sm","font-bold","text-gray-700","mb-2"]],template:function(i,e){i&1&&(o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),h(4,$,3,0,"div",4),o(5,"div",5),E(6,z,1,3,"app-product-card-add",null,w),h(8,G,2,2,"div",6),a(),h(9,H,8,0,"div",7),a(),o(10,"app-purchase-summary",8),x("continuarCompra",function(){return e.procesarCompra()}),a()()()()),i&2&&(s(4),C(4,e.shoppingCart().length!==0?4:-1),s(2),b(e.shoppingCart()),s(2),C(8,e.shoppingCart().length===0?8:-1),s(),C(9,e.shoppingCart().length!==0?9:-1))},dependencies:[A,M,Q,O,L,R,N],styles:[".custom-height[_ngcontent-%COMP%]{min-height:calc(100vh - 449px)}h3[_ngcontent-%COMP%], h2[_ngcontent-%COMP%], p[_ngcontent-%COMP%]{margin:0}"]})}}return r})();export{pt as CardOrderComponent};
