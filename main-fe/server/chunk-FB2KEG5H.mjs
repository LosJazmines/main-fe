import './polyfills.server.mjs';
import{a as oe}from"./chunk-L7WINZ3Z.mjs";import{b as ie,c as re,l as ne}from"./chunk-TTTSTSGJ.mjs";import{a as I}from"./chunk-Y7SIVDIG.mjs";import{b as G,d as J,g as K,i as X,ia as ee,la as te,s as Y,t as Z}from"./chunk-5ITMT7SL.mjs";import{b as q,e as z}from"./chunk-D4P4B6JA.mjs";import{a as Q,d as B}from"./chunk-5TOM3SNX.mjs";import{m as N,n as O,o as W,w as D}from"./chunk-DR63K3YT.mjs";import{Da as w,Ea as S,G as c,Hb as y,Jb as u,N as k,Oa as V,Tb as o,Ub as s,Vb as F,Z as g,Zb as E,aa as H,cc as m,ec as h,fa as A,ka as b,o as v,ob as d,oc as l,p,pb as C,qc as T,sa as j,tc as P,u as U,uc as M,vc as $,xc as L,zc as R}from"./chunk-XTO3CEGG.mjs";var se=(()=>{class r{constructor(e,i){this.http=e,this.store=i,this.publicApiUrl=`${I.api}/public/store`,this.apiUrl=`${I.api}/store`}getHeaders(){return this.store.select(oe).pipe(k(),U(e=>{let i=new Q;return e?.token?i.set("Authorization",`Bearer ${e.token}`):i}))}getCategories(){return this.http.get(`${this.publicApiUrl}/categories`).pipe(c(e=>(console.error("Error fetching categories:",e),v([]))))}getTags(){let e=`${this.publicApiUrl}/tags`;return console.log("Fetching tags from URL:",e),this.http.get(e).pipe(H(i=>console.log("Raw API response:",i)),c(i=>(console.error("Error fetching tags:",i),v([]))))}getCategory(e){return this.getHeaders().pipe(g(i=>this.http.get(`${this.apiUrl}/categories/${e}`,{headers:i}).pipe(c(t=>(console.error(`Error fetching category ${e}:`,t),p(()=>t))))))}createCategory(e){return this.getHeaders().pipe(g(i=>this.http.post(`${this.apiUrl}/categories`,e,{headers:i}).pipe(c(t=>(console.error("Error creating category:",t),p(()=>t))))))}updateCategory(e,i){return this.getHeaders().pipe(g(t=>this.http.put(`${this.apiUrl}/categories/${e}`,i,{headers:t}).pipe(c(n=>(console.error(`Error updating category ${e}:`,n),p(()=>n))))))}deleteCategory(e){return this.getHeaders().pipe(g(i=>this.http.delete(`${this.apiUrl}/categories/${e}`,{headers:i}).pipe(c(t=>(console.error(`Error deleting category ${e}:`,t),p(()=>t))))))}createTag(e){return this.getHeaders().pipe(g(i=>this.http.post(`${this.apiUrl}/tags`,e,{headers:i}).pipe(c(t=>(console.error("Error creating tag:",t),p(()=>t))))))}updateTag(e,i){return this.getHeaders().pipe(g(t=>this.http.put(`${this.apiUrl}/tags/${e}`,i,{headers:t}).pipe(c(n=>(console.error(`Error updating tag ${e}:`,n),p(()=>n))))))}deleteTag(e){return this.getHeaders().pipe(g(i=>this.http.delete(`${this.apiUrl}/tags/${e}`,{headers:i}).pipe(c(t=>(console.error(`Error deleting tag ${e}:`,t),p(()=>t))))))}static{this.\u0275fac=function(i){return new(i||r)(b(B),b(ne))}}static{this.\u0275prov=A({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var le=r=>({"bg-[#588157]/80":r});function pe(r,f){if(r&1){let e=E();o(0,"div",18),m("click",function(){let t=w(e).$implicit,n=h();return S(n.selectCategory(t.uuid))}),l(1),s()}if(r&2){let e=f.$implicit,i=h();u("ngClass",R(2,le,i.filters.selectedCategory===e.uuid)),d(),T(" ",e.name," ")}}function ge(r,f){r&1&&(o(0,"div",19),l(1," No hay tags disponibles "),s())}function de(r,f){if(r&1){let e=E();o(0,"div",18),m("click",function(){let t=w(e).$implicit,n=h();return S(n.selectTag(t.uuid))}),l(1),s()}if(r&2){let e=f.$implicit,i=h();u("ngClass",R(2,le,i.filters.selectedTag===e.uuid)),d(),T(" ",e.name," ")}}var $e=(()=>{class r{constructor(e,i,t){this.router=e,this.route=i,this.storeConfigService=t,this.filtersChanged=new V,this.filters={selectedCategory:null,selectedTag:null,priceRange:{min:null,max:null}},this.categories=[],this.tags=[]}ngOnInit(){this.loadCategoriesAndTags(),this.loadFiltersFromUrl()}loadFiltersFromUrl(){this.route.queryParams.subscribe(e=>{let i=e.category,t=e.tag,n=e.minPrice,a=e.maxPrice;if(this.categories.length&&i){let x=this.categories.find(_=>_.slug===i);this.filters.selectedCategory=x?.uuid||null}if(this.tags.length&&t){let x=this.tags.find(_=>_.slug===t);this.filters.selectedTag=x?.uuid||null}this.filters.priceRange={min:n?+n:null,max:a?+a:null},this.emitFiltersChanged()})}loadCategoriesAndTags(){console.log("Starting to load categories and tags..."),this.storeConfigService.getCategories().subscribe({next:e=>{console.log("Categories loaded:",e),this.categories=e},error:e=>{console.error("Error loading categories:",e)}}),this.storeConfigService.getTags().subscribe({next:e=>{console.log("Tags loaded from service:",e),this.tags=e},error:e=>{console.error("Error loading tags:",e)}})}updateQueryParams(){let e=this.categories.find(t=>t.uuid===this.filters.selectedCategory),i=this.tags.find(t=>t.uuid===this.filters.selectedTag);this.router.navigate([],{relativeTo:this.route,queryParams:{category:e?.slug||null,tag:i?.slug||null,minPrice:this.filters.priceRange.min,maxPrice:this.filters.priceRange.max},queryParamsHandling:"merge"}),this.emitFiltersChanged()}onPriceInput(){this.updateQueryParams()}selectCategory(e){this.filters.selectedCategory=e,this.updateQueryParams()}selectTag(e){this.filters.selectedTag=e,this.updateQueryParams()}clearFilters(){this.filters={selectedCategory:null,selectedTag:null,priceRange:{min:null,max:null}},this.updateQueryParams()}emitFiltersChanged(){this.filtersChanged.emit({category:this.filters.selectedCategory,tag:this.filters.selectedTag,priceRange:this.filters.priceRange})}static{this.\u0275fac=function(i){return new(i||r)(C(z),C(q),C(se))}}static{this.\u0275cmp=j({type:r,selectors:[["app-shop-filters"]],outputs:{filtersChanged:"filtersChanged"},standalone:!0,features:[L],decls:32,vars:5,consts:[[1,"w-72","bg-[#588157]/90","h-full","backdrop-blur-lg","rounded-[4px]","p-6","shadow-lg"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-xl","font-semibold","text-white","!m-0"],[1,"space-y-5"],[1,"mb-6"],[1,"text-base","font-medium","text-white","!m-0"],[1,"space-y-1"],["class","text-white/80 cursor-pointer px-4 py-2 rounded-[4px] hover:bg-[#588157]/60 transition-colors",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"border-white/20","!mt-2"],["class","text-white/60 text-sm mt-2",4,"ngIf"],[1,"space-y-1","mt-2"],[1,"my-6","border-gray-500/50"],[1,"mt-6"],[1,"mt-4","flex","gap-2"],[1,"text-white/80","text-sm","mb-1","block"],["type","number","placeholder","0",1,"w-full","bg-white/10","text-white","placeholder-white/60","border","border-white/20","rounded-[4px]","px-3","py-2","focus:outline-none","focus:border-white/40",3,"ngModelChange","input","ngModel"],["type","number","placeholder","1000",1,"w-full","bg-white/10","text-white","placeholder-white/60","border","border-white/20","rounded-[4px]","px-3","py-2","focus:outline-none","focus:border-white/40",3,"ngModelChange","input","ngModel"],[1,"mt-6","w-full","bg-white/10","text-white","hover:bg-white/20","transition-colors","rounded-[4px]","px-4","py-2",3,"click"],[1,"text-white/80","cursor-pointer","px-4","py-2","rounded-[4px]","hover:bg-[#588157]/60","transition-colors",3,"click","ngClass"],[1,"text-white/60","text-sm","mt-2"]],template:function(i,t){i&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),l(3,"Filtros"),s()(),o(4,"div",3)(5,"div",4)(6,"h3",5),l(7,"Categor\xEDas"),s(),o(8,"div",6),y(9,pe,2,4,"div",7),s()(),F(10,"hr",8),o(11,"div")(12,"h3",5),l(13,"Tags"),s(),y(14,ge,2,0,"div",9),o(15,"div",10),y(16,de,2,4,"div",7),s()(),F(17,"hr",11),o(18,"div",12)(19,"h3",5),l(20,"Rango de Precio"),s(),o(21,"div",13)(22,"div")(23,"label",14),l(24,"Precio M\xEDnimo"),s(),o(25,"input",15),$("ngModelChange",function(a){return M(t.filters.priceRange.min,a)||(t.filters.priceRange.min=a),a}),m("input",function(){return t.onPriceInput()}),s()(),o(26,"div")(27,"label",14),l(28,"Precio M\xE1ximo"),s(),o(29,"input",16),$("ngModelChange",function(a){return M(t.filters.priceRange.max,a)||(t.filters.priceRange.max=a),a}),m("input",function(){return t.onPriceInput()}),s()()()()(),o(30,"button",17),m("click",function(){return t.clearFilters()}),l(31," Borrar filtros "),s()()),i&2&&(d(9),u("ngForOf",t.categories),d(5),u("ngIf",!(t.tags!=null&&t.tags.length)),d(2),u("ngForOf",t.tags),d(9),P("ngModel",t.filters.priceRange.min),d(4),P("ngModel",t.filters.priceRange.max))},dependencies:[D,N,O,W,te,Y,G,X,J,K,ee,Z]})}}return r})();var Ue=ie("[Left Sidebar Filters] Toggle Left Sidebar Filters",re());export{$e as a,Ue as b};
