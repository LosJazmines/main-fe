import{a as C}from"./chunk-IRFR7VQN.js";import"./chunk-Q7WZ5A67.js";import{a as H}from"./chunk-RAAZGNEA.js";import"./chunk-YVLEHWOY.js";import{a as J}from"./chunk-BFSNZW6T.js";import{a as K}from"./chunk-TPLJ4PUN.js";import"./chunk-MNLYAPXW.js";import{l as q}from"./chunk-EWYMWOI3.js";import{a as G}from"./chunk-HE4HGFF6.js";import{ia as B,la as P,u as V,w as L}from"./chunk-GX2JBJOU.js";import{d as O}from"./chunk-LKSAQKNU.js";import{Na as z,d as F}from"./chunk-2PA5JSTX.js";import{k as D,m as $,q as W,u as M}from"./chunk-OE5DTYP4.js";import{Ac as A,Dc as I,Fc as R,Hc as T,Ia as b,Ja as g,Kb as S,Mb as l,Rb as N,Ub as w,Vb as j,Wb as o,Xb as a,Yb as p,ac as v,fa as u,fc as x,hc as f,ka as y,l as k,pa as _,rb as r,rc as s,sb as m,sc as U,tc as h,xa as E}from"./chunk-W7KOHNRA.js";var Q=(()=>{class n{constructor(t,e){this.http=t,this.wsService=e,this.apiUrl=`${G.api}/notifications`,this.notificationsSubject=new k([]),this.unreadCountSubject=new k(0),this.notifications$=this.notificationsSubject.asObservable(),this.unreadCount$=this.unreadCountSubject.asObservable(),this.setupWebSocketListeners(),console.log("NotificationService initialized")}setupWebSocketListeners(){this.wsService.getNotifications().subscribe({next:t=>{this.addNotification(t)},error:t=>console.error("Error in notification socket:",t)}),this.wsService.getAdminNotifications().subscribe({next:t=>{this.addNotification(t)},error:t=>console.error("Error in admin notification socket:",t)})}getAllNotifications(){return this.http.get(`${this.apiUrl}/admin`).pipe(u(t=>{this.notificationsSubject.next(t),this.updateUnreadCount()}))}getUserNotifications(t){return this.http.get(`${this.apiUrl}/user/${t}`).pipe(u(e=>{this.notificationsSubject.next(e),this.updateUnreadCount()}))}markAsRead(t){return this.http.patch(`${this.apiUrl}/${t}/read`,{}).pipe(u(()=>{let e=this.notificationsSubject.value,i=e.find(d=>d.id===t);i&&(i.read=!0,this.notificationsSubject.next(e),this.updateUnreadCount())}))}markAllAsRead(){return this.http.patch(`${this.apiUrl}/mark-all-read`,{}).pipe(u(()=>{let t=this.notificationsSubject.value;t.forEach(e=>{e.read=!0}),this.notificationsSubject.next(t),this.updateUnreadCount()}))}deleteNotification(t){return this.http.delete(`${this.apiUrl}/${t}`).pipe(u(()=>{let e=this.notificationsSubject.value.filter(i=>i.id!==t);this.notificationsSubject.next(e),this.updateUnreadCount()}))}updateUnreadCount(){let e=this.notificationsSubject.value.filter(i=>i&&!i.read).length;this.unreadCountSubject.next(e)}addNotification(t){let e=this.notificationsSubject.value;e.unshift(t),this.notificationsSubject.next(e),this.updateUnreadCount()}clearNotifications(){this.notificationsSubject.next([]),this.unreadCountSubject.next(0)}getAdminNotifications(){return this.http.get(`${this.apiUrl}/admin`).pipe(u(t=>{this.notificationsSubject.next(t),this.updateUnreadCount()}))}static{this.\u0275fac=function(e){return new(e||n)(_(F),_(C))}}static{this.\u0275prov=y({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var it=(n,c)=>c.id,nt=(n,c)=>({"border-[#3a5a40]/20 bg-gradient-to-r from-[#3a5a40]/5 to-transparent":n,"border-gray-100":c});function ot(n,c){if(n&1){let t=v();o(0,"button",11),x("click",function(){b(t);let i=f();return g(i.markAllAsRead())}),o(1,"span",12),p(2,"lucide-icon",13),s(3," Marcar todas como le\xEDdas "),a()()}}function at(n,c){n&1&&(o(0,"span",26),s(1," No le\xEDdo "),a())}function rt(n,c){if(n&1){let t=v();o(0,"button",32),x("click",function(){b(t);let i=f().$implicit,d=f();return g(d.markAsRead(i))}),p(1,"lucide-icon",33),a()}}function st(n,c){if(n&1){let t=v();o(0,"div",14)(1,"div",15)(2,"div",16)(3,"div",17)(4,"div",18)(5,"div",19),p(6,"lucide-icon",20),a(),o(7,"div")(8,"h3",21),s(9),a(),o(10,"span",22),s(11),R(12,"date"),a()()(),o(13,"div",23)(14,"p",24),s(15),a()(),o(16,"div",25),S(17,at,2,0,"span",26),o(18,"span",27),s(19),a()()(),o(20,"div",28),S(21,rt,2,0,"button",29),o(22,"button",30),x("click",function(){let i=b(t).$implicit,d=f();return g(d.viewDetails(i))}),p(23,"lucide-icon",31),a()()()()()}if(n&2){let t=c.$implicit;l("ngClass",I(14,nt,!t.read,t.read)),r(5),l("ngClass",t.read?"bg-gray-100":"bg-[#3a5a40]/10"),r(),l("name",t.type==="ORDER"?"shopping-cart":"mail")("ngClass",t.read?"text-gray-500":"text-[#3a5a40]"),r(3),h(" ",t.title||"Nueva notificaci\xF3n"," "),r(2),h(" ",T(12,11,t.createdAt,"medium")," "),r(4),U(t.message),r(2),N(17,t.read?-1:17),r(),l("ngClass",t.type==="ORDER"?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700"),r(),h(" ",t.type==="ORDER"?"Orden":"Contacto"," "),r(2),N(21,t.read?-1:21)}}function ct(n,c){n&1&&(o(0,"div",10)(1,"div",34),p(2,"lucide-icon",35),o(3,"div")(4,"h3",36),s(5," No hay notificaciones "),a(),o(6,"p",37),s(7," Las notificaciones aparecer\xE1n aqu\xED cuando haya nuevas actualizaciones. "),a()()()())}var Nt=(()=>{class n{constructor(t,e,i,d,X,Y){this.notificationsService=t,this.router=e,this.webSocketService=i,this.tokenService=d,this.messageService=X,this.store=Y,this.notifications=[],this.hasUnreadNotifications=!1,this.isWebSocketConnected=!1,this.subscriptions=[]}ngOnInit(){this.loadNotifications(),this.checkAuthAndInitSocket()}checkAuthAndInitSocket(){let t=this.store.select(H).subscribe(e=>{let i=this.tokenService.getToken();e&&i&&this.setupWebSocketConnection()});this.subscriptions.push(t)}setupWebSocketConnection(){let t=this.tokenService.getToken();if(!t)return;this.webSocketService.connect(t);let e=this.webSocketService.getConnectionStatus().subscribe(i=>{this.isWebSocketConnected=i,i?(this.setupWebSocketListeners(),this.messageService.showSuccess("Conexi\xF3n WebSocket establecida","top right",3e3)):this.messageService.showError("Conexi\xF3n WebSocket perdida","top right",3e3)});this.subscriptions.push(e)}setupWebSocketListeners(){let t=this.webSocketService.getNotifications().subscribe(e=>{e&&(this.notifications=[e,...this.notifications],this.updateUnreadStatus(),this.messageService.showSuccess("Nueva notificaci\xF3n recibida","top right",5e3))});this.subscriptions.push(t)}loadNotifications(){let t=this.notificationsService.getAllNotifications().subscribe({next:e=>{this.notifications=e,this.updateUnreadStatus()},error:e=>{console.error("Error loading notifications:",e),this.messageService.showError("Error al cargar las notificaciones","top right",3e3)}});this.subscriptions.push(t)}updateUnreadStatus(){this.hasUnreadNotifications=this.notifications.some(t=>!t.read)}markAsRead(t){let e=this.notificationsService.markAsRead(t.id).subscribe({next:()=>{t.read=!0,this.updateUnreadStatus(),this.messageService.showSuccess("Notificaci\xF3n marcada como le\xEDda","top right",3e3)},error:i=>{console.error("Error marking notification as read:",i),this.messageService.showError("Error al marcar la notificaci\xF3n como le\xEDda","top right",3e3)}});this.subscriptions.push(e)}markAllAsRead(){let t=this.notificationsService.markAllAsRead().subscribe({next:()=>{this.notifications.forEach(e=>e.read=!0),this.updateUnreadStatus(),this.messageService.showSuccess("Todas las notificaciones marcadas como le\xEDdas","top right",3e3)},error:e=>{console.error("Error marking all notifications as read:",e),this.messageService.showError("Error al marcar todas las notificaciones como le\xEDdas","top right",3e3)}});this.subscriptions.push(t)}viewDetails(t){t.type==="ORDER"&&t.relatedId&&this.router.navigate(["/admin/orders",t.relatedId])}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}static{this.\u0275fac=function(e){return new(e||n)(m(Q),m(O),m(C),m(J),m(K),m(q))}}static{this.\u0275cmp=E({type:n,selectors:[["app-notifications"]],standalone:!0,features:[A],decls:16,vars:5,consts:[[1,"container","mx-auto","px-4","py-8"],[1,"flex","justify-between","items-center","mb-8"],[1,"text-3xl","font-playfair","text-[#3a5a40]","font-semibold"],[1,"text-gray-600","mt-2"],[1,"flex","items-center","gap-2","mr-4"],[1,"w-2","h-2","rounded-full","animate-pulse",3,"ngClass"],[1,"text-sm",3,"ngClass"],["class","bg-[#3a5a40] hover:bg-[#3a5a40]/80 text-white px-4 py-2 rounded-md transition-all duration-300",3,"click",4,"ngIf"],[1,"grid","gap-4"],[1,"bg-white","rounded-lg","shadow-sm","border","transition-all","duration-200","hover:shadow-md"],[1,"text-center","py-16","bg-gray-50","rounded-lg","border","border-dashed","border-gray-300"],[1,"bg-[#3a5a40]","hover:bg-[#3a5a40]/80","text-white","px-4","py-2","rounded-md","transition-all","duration-300",3,"click"],[1,"flex","items-center","gap-2"],["name","check-circle"],[1,"bg-white","rounded-lg","shadow-sm","border","transition-all","duration-200","hover:shadow-md",3,"ngClass"],[1,"p-6"],[1,"flex","items-start","justify-between"],[1,"flex-1"],[1,"flex","items-center","gap-3"],[1,"rounded-full","p-2",3,"ngClass"],["size","20",3,"name","ngClass"],[1,"text-lg","font-semibold","text-[#3a5a40]"],[1,"text-sm","text-gray-500"],[1,"mt-4"],[1,"text-gray-600"],[1,"flex","items-center","gap-3","mt-4"],[1,"inline-flex","items-center","px-3","py-1","rounded-full","text-sm","font-medium","bg-[#3a5a40]/10","text-[#3a5a40]"],[1,"inline-flex","items-center","px-3","py-1","rounded-full","text-sm","font-medium",3,"ngClass"],[1,"flex","items-start","gap-2"],["mat-icon-button","","matTooltip","Marcar como le\xEDda",1,"text-[#3a5a40]","hover:bg-[#3a5a40]/10","transition-colors","duration-200"],["mat-icon-button","","matTooltip","Ver detalles",1,"text-[#3a5a40]","hover:bg-[#3a5a40]/10","transition-colors","duration-200",3,"click"],["name","external-link"],["mat-icon-button","","matTooltip","Marcar como le\xEDda",1,"text-[#3a5a40]","hover:bg-[#3a5a40]/10","transition-colors","duration-200",3,"click"],["name","check"],[1,"flex","flex-col","items-center","gap-4"],["name","bell-off","size","48",1,"text-gray-400"],[1,"text-lg","font-medium","text-gray-900"],[1,"text-gray-500","mt-1"]],template:function(e,i){e&1&&(o(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),s(4," Notificaciones "),a(),o(5,"p",3),s(6," Administra todas las notificaciones del sistema "),a()(),o(7,"div",4),p(8,"span",5),o(9,"span",6),s(10),a()(),S(11,ot,4,0,"button",7),a(),o(12,"div",8),w(13,st,24,17,"div",9,it,!1,ct,8,0,"div",10),a()()),e&2&&(r(8),l("ngClass",i.isWebSocketConnected?"bg-green-500":"bg-red-500"),r(),l("ngClass",i.isWebSocketConnected?"text-green-600":"text-red-600"),r(),h(" ",i.isWebSocketConnected?"Conectado en tiempo real":"Desconectado - Reconectando..."," "),r(),l("ngIf",i.hasUnreadNotifications),r(2),j(i.notifications))},dependencies:[M,D,$,W,P,z,B,L,V],styles:["[_nghost-%COMP%]{display:block}"]})}}return n})();export{Nt as NotificationsComponent};
