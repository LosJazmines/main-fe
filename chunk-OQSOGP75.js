import{a as q}from"./chunk-IBMWJLA5.js";import"./chunk-TKMMNMX2.js";import{a as z}from"./chunk-RAAZGNEA.js";import{a as G}from"./chunk-3QEC7GEK.js";import"./chunk-TPLJ4PUN.js";import{l as j}from"./chunk-EWYMWOI3.js";import{a as b}from"./chunk-HE4HGFF6.js";import{b as R,d as T,f as V,j as F,k as O,la as $,t as k,u as H,w as N}from"./chunk-GX2JBJOU.js";import"./chunk-2PA5JSTX.js";import{l as U,m as D,u as L}from"./chunk-OE5DTYP4.js";import{Ac as I,Ia as p,Ja as u,Kb as x,Kc as A,Mb as m,Ob as C,P as _,T as S,Wb as t,Xb as i,Yb as h,ac as y,f as P,fc as f,hc as c,qa as d,qc as E,rb as s,rc as r,sc as v,tc as M,xa as w}from"./chunk-W7KOHNRA.js";function B(a,g){if(a&1){let e=y();t(0,"tr",15)(1,"td",13),r(2),i(),t(3,"td",13),r(4),i(),t(5,"td",13)(6,"div",16)(7,"input",17),f("change",function(){let o=p(e).$implicit,l=c(2);return u(l.setActivePayment(o))}),i(),t(8,"span"),r(9),i()()(),t(10,"td",13)(11,"button",18),f("click",function(){let o=p(e).$implicit,l=c(2);return u(l.onDelete(o.id))}),r(12," Eliminar "),i()()()}if(a&2){let e=g.$implicit,n=c(2);s(2),v(e.id),s(2),v(e.name),s(3),m("value",e.id)("formControl",n.formActivePayments),s(),C("text-green-600",e.active),s(),M(" ",e.active?"Activa":"Inactiva"," "),s(2),m("disabled",n.isLoading)}}function J(a,g){if(a&1&&(t(0,"div",8)(1,"h2",9),r(2,"Cuentas Integradas"),i(),t(3,"div",10)(4,"table",11)(5,"thead")(6,"tr",12)(7,"th",13),r(8,"ID"),i(),t(9,"th",13),r(10,"Nombre"),i(),t(11,"th",13),r(12,"Estado"),i(),t(13,"th",13),r(14,"Acciones"),i()()(),t(15,"tbody"),x(16,B,13,8,"tr",14),i()()()()),a&2){let e=c();s(16),m("ngForOf",e.paymentSettings)}}function K(a,g){a&1&&(t(0,"div",19),h(1,"lucide-icon",20),t(2,"h2",21),r(3," Sin Cuentas Integradas "),i(),t(4,"p",22),r(5," Integre una cuenta de MercadoPago para poder utilizar esta funcionalidad. "),i()())}var ue=(()=>{class a{constructor(){this._adminHeaderStore=d(q),this._mercadoPagoService=d(G),this._store=d(j),this.adminHeaderStore$=this._adminHeaderStore.getHeaderTitle(),this.isLoading=!1,this.paymentSettings=[],this.formActivePayments=new V(null),this._unsubscribeAll=new P,this.MP_URL=null}ngOnInit(){this._adminHeaderStore.updateHeaderTitle("Payments"),this.loadCurrentUser(),this.loadPaymentSettings()}ngOnDestroy(){this._unsubscribeAll.unsubscribe()}loadCurrentUser(){this._unsubscribeAll.add(this._store.select(z).subscribe(e=>{this.currentUser=e,e&&this.getMercadoPagoUrl()}))}getMercadoPagoUrl(){let e=b.mp.OUR_MP_CLIENT_ID,n=crypto.randomUUID();this.MP_URL=b.mp.MP_URL.replace("OUR_MP_CLIENT_ID",e).replace("RANDOM_ID",n).replace("PRODUCER_ID",this.currentUser?.id||"")}loadPaymentSettings(){this._mercadoPagoService.getPaymentSettings().pipe(_(1)).subscribe(e=>{this.paymentSettings=e,this.paymentSettings.length===1&&this.setActivePayment(this.paymentSettings[0]);let n=this.paymentSettings.find(o=>o.active);this.formActivePayments.setValue(n?n.id:null)})}setActivePayment(e){this._mercadoPagoService.setActivePayment(e.id).pipe(_(1)).subscribe(()=>{this.formActivePayments.setValue(e.id)})}redirectToMercadoPago(){this.MP_URL&&(window.location.href=this.MP_URL)}onDelete(e){confirm("\xBFEst\xE1s seguro de eliminar esta cuenta?")&&(this.isLoading=!0,this._mercadoPagoService.deleteAccount(e).pipe(S(()=>this.isLoading=!1)).subscribe(n=>{n&&this.loadPaymentSettings()}))}static{this.\u0275fac=function(n){return new(n||a)}}static{this.\u0275cmp=w({type:a,selectors:[["app-payments"]],standalone:!0,features:[I],decls:11,vars:3,consts:[["noAccounts",""],[1,"min-h-full"],[1,"w-full","flex","flex-col","lg:flex-row","justify-between","items-center","mb-4","gap-4"],[1,"text-3xl","mb-6","text-[#3a5a40]","!font-playfair","text-start","w-full"],[1,"w-full","flex","flex-col","lg:flex-row","justify-end","items-center","gap-4"],[1,"w-full","lg:w-max","px-4","py-2","bg-[#3a5a40]/80","text-white","rounded-[4px]","shadow","hover:bg-[#3a5a40]/80","focus:outline-none","transition","flex","items-center","gap-2",3,"click","disabled"],["name","plus",1,"w-5","h-5"],["class","bg-white shadow rounded-[4px] p-6",4,"ngIf","ngIfElse"],[1,"bg-white","shadow","rounded-[4px]","p-6"],[1,"text-xl","font-semibold","text-gray-700","mb-4"],[1,"overflow-x-auto"],[1,"table-auto","w-full","border-collapse"],[1,"bg-gray-200","text-gray-600","text-sm","uppercase","text-left"],[1,"p-3"],["class","border-t",4,"ngFor","ngForOf"],[1,"border-t"],[1,"flex","items-center"],["type","radio",1,"mr-2",3,"change","value","formControl"],[1,"bg-red-500","text-white","px-3","py-1","rounded-[4px]","text-sm",3,"click","disabled"],[1,"bg-white","shadow","rounded-[4px]","p-6","flex","flex-col","items-center"],["name","info",1,"text-4xl","text-gray-400","mb-4"],[1,"text-xl","font-semibold","text-gray-700","mb-2"],[1,"text-gray-500","text-center"]],template:function(n,o){if(n&1){let l=y();t(0,"div",1)(1,"div",2)(2,"h1",3),r(3," Gesti\xF3n de Cuentas MercadoPago "),i(),t(4,"div",4)(5,"button",5),f("click",function(){return p(l),u(o.redirectToMercadoPago())}),h(6,"lucide-icon",6),r(7," Integrar cuenta de MercadoPago "),i()()(),x(8,J,17,1,"div",7)(9,K,6,0,"ng-template",null,0,A),i()}if(n&2){let l=E(10);s(5),m("disabled",o.isLoading||!o.MP_URL),s(3),m("ngIf",o.paymentSettings.length>0)("ngIfElse",l)}},dependencies:[L,U,D,$,N,H,k,R,F,T,O]})}}return a})();export{ue as default};
